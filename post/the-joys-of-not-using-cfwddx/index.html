<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Adam.Blog()</title>
        <meta name="author">
        <meta name="description" content="I&#39;m bringin&#39; nerdy back">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="generator" content="Hugo 0.16-DEV" />
          <link href="http://adampresley.com/post/index.xml" rel="alternate" type="application/rss+xml" title="Adam.Blog()" />
          <link href="http://adampresley.com/post/index.xml" rel="feed" type="application/rss+xml" title="Adam.Blog()" />
        <link href='//fonts.googleapis.com/css?family=Roboto:400,300,700|Noto+Serif:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="http://adampresley.com/css/styles.css">
        <link rel="icon" href="http://adampresley.com/favicon.ico">
        <link rel="apple-touch-icon" href="http://adampresley.com/apple-touch-icon.png" />
        <link rel="stylesheet" href="http://adampresley.com/css/highlightjs/monokai.css">
        <script src="http://adampresley.com/js/vendor/modernizr-2.8.0.min.js"></script>
        <style>
        .site-header h2 .logo {
        background: url(http://adampresley.com/assets/images/code-background-screenshot.png) no-repeat 0 0;
        }
        @media (min--moz-device-pixel-ratio: 1.3), (-o-min-device-pixel-ratio: 2.6 / 2), (-webkit-min-device-pixel-ratio: 1.3), (min-device-pixel-ratio: 1.3), (min-resolution: 1.3dppx) {
          .site-header h2 .logo {
            background-image: url(http://adampresley.com/assets/images/code-background-screenshot.png);
        }}
       .site-header {
         background: #2a373d url(http://adampresley.com/assets/images/code-background-screenshot.png) no-repeat center center;
         z-index: -1;
        }
        </style>
    </head>
    <body>
        
        <header class="site-header">
          <div class="transparent-layer">
              <h2>Adam.Blog()</h2>
          </div>
        </header>


<div class="container clearfix">
    <main role="main" class="content">
        <article class="post">
            <a class="btn home" href="http://adampresley.com/" title="">&laquo; </a>
            
<h1><a href="http://adampresley.com/post/the-joys-of-not-using-cfwddx/" title="The Joys of NOT Using CFWDDX">The Joys of NOT Using CFWDDX</a></h1>

<footer class="post-info"> <span class="post-meta"><time datetime="2010.02.19">2010.02.19</time>

    &middot; 
        
        <a href="http://adampresley.com/tags/development">development</a>, 
        
        <a href="http://adampresley.com/tags/coldfusion">coldfusion</a>, 
        
        <a href="http://adampresley.com/tags/javascript">javascript</a>
        
    

</span>
</footer>

            <p>I had the pleasure of working an issue just the other day where an
internal web application didn&rsquo;t seem to be responding. At first I
suspected some type of bug in environment configuration, or some other
type of obscure thing. The app worked in other environments, so that was
my first suspicion. After a bit of digging I discovered this little
nugget (changed a bit to protect the innocent of course).</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">cfwddx</span> <span style="color: #a6e22e">action</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;cfml2js&quot;</span> <span style="color: #a6e22e">input</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;#rc.query#&quot;</span> <span style="color: #a6e22e">topLevelVariable</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;data&quot;</span> <span style="color: #f8f8f2">/&gt;</span>
</pre></div>


<p>Let me start by telling you what this function does. The CFWDDX tag,
with the action of <em>cfml2js</em> takes some object, in this case a query,
and converts it to JavaScript code. Let&rsquo;s see what kind of JavaScript
this produces by taking an imaginary query object that has 2 columns,
<strong>firstName</strong>, and <strong>lastName</strong>, and has two records. This is
what the JavaScript would look like on the rendered page.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">&lt;</span><span style="color: #a6e22e">script</span><span style="color: #f92672">&gt;</span>

<span style="color: #a6e22e">data</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #a6e22e">WddxRecordset</span><span style="color: #f8f8f2">();</span>
<span style="color: #a6e22e">col0</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Array();</span>
<span style="color: #a6e22e">col0</span><span style="color: #f8f8f2">[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Adam&quot;</span><span style="color: #f8f8f2">;</span>
<span style="color: #a6e22e">col0</span><span style="color: #f8f8f2">[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Ben&quot;</span><span style="color: #f8f8f2">;</span>
<span style="color: #a6e22e">data</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;firstName&quot;</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">col0</span><span style="color: #f8f8f2">;</span>
<span style="color: #a6e22e">col0</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">;</span>
<span style="color: #a6e22e">col1</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Array();</span>
<span style="color: #a6e22e">col1</span><span style="color: #f8f8f2">[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Presley&quot;</span><span style="color: #f8f8f2">;</span>
<span style="color: #a6e22e">col1</span><span style="color: #f8f8f2">[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Nadel&quot;</span><span style="color: #f8f8f2">;</span>
<span style="color: #a6e22e">data</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;lastName&quot;</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">col1</span><span style="color: #f8f8f2">;</span>
<span style="color: #a6e22e">col1</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">null</span><span style="color: #f8f8f2">;</span>

<span style="color: #f92672">&lt;</span><span style="color: #960050; background-color: #1e0010">/script&gt;</span>
</pre></div>


<p>Ok, now imagine that, but a query with 123 records and 8 columns. That&rsquo;s
about 1,021 lines of generated JavaScript put right into the page. That
by itself isn&rsquo;t too terrifying, but I was still having a problem. Why?
Let&rsquo;s take a look.</p>

<p>Another bit of code in a separate JS file actually had some methods
executing when the document is ready. One of those methods relied on
this array data generated above to be present. Turns out my computer was
running <strong>so slow</strong> that the DOM was ready before the JS was done
parsing, so the method executed, and the array wasn&rsquo;t quite done,
therefore the page stopped running because the variable didn&rsquo;t exist.
And that was the actual error that was occurring. The variable didn&rsquo;t
exist.</p>

<p>So why is this bad, and what can we do to fix it? It&rsquo;s bad because of
two reasons.</p>

<ol>
<li>The DOM was actually ready before the script was finished parsing. The code didn&rsquo;t account for slower PCs.</li>
<li>There are more modern ways of doing this.</li>
</ol>

<p>To address this issue the first order of business was to remove the CFWDDX piece. That code is quite large,
roughly 20K of generated JavaScript. We can instead render the form,
block it, then make an AJAX call to go and get that data once the DOM is
ready. This will return a JSON response that is much lighter, weighing
in at about 11K.</p>

<p>A coworker asked a good question at this point, suggesting that it was
bad to go out and perform an AJAX call every time I needed this data,
because it never changes during the course of application execution.
Luckily I was a step ahead of him, as once I got the data the first
time, I store it in memory to be reused as often as needed.</p>

<p>Although I cannot post the actual code up here, I will provide a watered
down version of it to show how I did the AJAX call with jQuery, as well
as a quick in-memory index so I could reference the resulting JSON array
by column name. Why? Because we use ColdBox, and the query is serialized
using <em>serializeJson()</em> which makes the query into an array of arrays,
and the columns are stored in a separate array. I&rsquo;ve blogged on this
&ldquo;issue&rdquo; before for those interested.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">MyPage</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">config</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
	<span style="color: #66d9ef">this</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">initialize</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">()</span> <span style="color: #f8f8f2">{</span>
		<span style="color: #a6e22e">jQuery</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">ajax</span><span style="color: #f8f8f2">({</span>
			<span style="color: #a6e22e">data</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">{</span>
				<span style="color: #a6e22e">event</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;section.getData&quot;</span><span style="color: #f8f8f2">,</span>
				<span style="color: #a6e22e">method</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;process&quot;</span><span style="color: #f8f8f2">,</span>
				<span style="color: #a6e22e">returnFormat</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;json&quot;</span>
			<span style="color: #f8f8f2">},</span>
			<span style="color: #a6e22e">url</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;coldboxproxy.cfc&quot;</span><span style="color: #f8f8f2">,</span>
			<span style="color: #a6e22e">dataType</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;json&quot;</span><span style="color: #f8f8f2">,</span>
			<span style="color: #a6e22e">success</span><span style="color: #f92672">:</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">data</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
				<span style="color: #a6e22e">__config</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">dataIdx</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">__this</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">buildIndex</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">data</span><span style="color: #f8f8f2">);</span>
				<span style="color: #a6e22e">__config</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">data</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">data</span><span style="color: #f8f8f2">;</span>
			<span style="color: #f8f8f2">}</span>
		<span style="color: #f8f8f2">});</span>
	<span style="color: #f8f8f2">};</span>

	<span style="color: #66d9ef">this</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">buildIndex</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">data</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
		<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">i</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
		<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">{};</span>

		<span style="color: #75715e">/*</span>
<span style="color: #75715e">		 * The COLUMNS key contains the query&#39;s columns array.</span>
<span style="color: #75715e">		 */</span>
		<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">(</span><span style="color: #a6e22e">i</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span> <span style="color: #a6e22e">i</span> <span style="color: #f92672">&lt;</span> <span style="color: #a6e22e">data</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">COLUMNS</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">length</span><span style="color: #f8f8f2">;</span> <span style="color: #a6e22e">i</span><span style="color: #f92672">++</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
			<span style="color: #a6e22e">result</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">data</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">COLUMNS</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">i</span><span style="color: #f8f8f2">]]</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">i</span><span style="color: #f8f8f2">;</span>
		<span style="color: #f8f8f2">}</span>

		<span style="color: #66d9ef">return</span> <span style="color: #a6e22e">result</span><span style="color: #f8f8f2">;</span>
	<span style="color: #f8f8f2">};</span>

	<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">__config</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">jQuery</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">extend</span><span style="color: #f8f8f2">({},</span> <span style="color: #a6e22e">config</span><span style="color: #f8f8f2">);</span>
	<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">__this</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">this</span><span style="color: #f8f8f2">;</span>

	<span style="color: #66d9ef">this</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">initialize</span><span style="color: #f8f8f2">();</span>
<span style="color: #f8f8f2">};</span>
</pre></div>
</p>

<p>In the above code we create a container object, or <strong>namespace</strong> as
you may hear some people call it, which holds all the functionality for
this page. This allows me to create functions and variables that won&rsquo;t
step on any &ldquo;global&rdquo; toes.</p>

<p>The object automatically calls the <em>initialize</em> method, which fires
off an AJAX call to get the JSON data. I then, upon success, call a
quick function to create an &ldquo;index&rdquo;. Normally, if I wanted to reference
<em>lastName</em> from my serialized query, I would do this.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">lastName</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">__config</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">data</span><span style="color: #f8f8f2">[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">][</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">];</span>
</pre></div>
</p>

<p>The index of 1 is the second column in the query. I wanted to reference
by the column name, however. Creating that index allows me to do this.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">lastName</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">__config</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">data</span><span style="color: #f8f8f2">[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">][</span><span style="color: #a6e22e">__config</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">dataIdx</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">LASTNAME</span><span style="color: #f8f8f2">];</span>
</pre></div>
</p>

<p>Although I prefer to create code on the ColdFusion side to transform the
query to JSON that allows me to do that in JavaScript, I did not have
that luxury at this point, so this was a close second.</p>

<p>Hope this rambling made some sense!! Happy coding!</p>

            <ul class="share-buttons">
    <li></li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fadampresley.com%2fpost%2fthe-joys-of-not-using-cfwddx%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=The%20Joys%20of%20NOT%20Using%20CFWDDX&amp;url=http%3a%2f%2fadampresley.com%2fpost%2fthe-joys-of-not-using-cfwddx%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-gplus" href="https://plus.google.com/share?url=http%3a%2f%2fadampresley.com%2fpost%2fthe-joys-of-not-using-cfwddx%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fadampresley.com%2fpost%2fthe-joys-of-not-using-cfwddx%2f&title=The%20Joys%20of%20NOT%20Using%20CFWDDX" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title=""></a>
    </li>
</ul>

        </article>
        <div class="comments">
            <h3></h3>
            <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'adampresleyblog';
    var disqus_identifier = 'http:\/\/adampresley.com\/post\/the-joys-of-not-using-cfwddx\/';
    var disqus_title = 'The Joys of NOT Using CFWDDX';
    var disqus_url = 'http:\/\/adampresley.com\/post\/the-joys-of-not-using-cfwddx\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    </main>
    <aside class="author">
  <img class="profile-image" src="http://adampresley.com/assets/adampresley/images/adam-bowtie.png" alt="Adam Presley" />
  <p class="name"> 
  <strong>Adam Presley</strong></p>
  <p class="address">Texas, USA</p>
  <p class="link"></p>
  <ul class="social">
    
<li><a href="//twitter.com/adampresley" class="icon-twitter" target="_blank" title="Twitter"></a></li>













<li><a href="//github.com/adampresley" class="icon-github" target="_blank" title="Github"></a></li>




<li><a href="http://adampresley.com/post/index.xml" class="icon-rss" target="_blank" title="RSS"></a></li>

  </ul>
  <br><br>
</aside>

</div>

<footer class="main-footer">
  <div class="container clearfix">
        <a class="icon-rss" href="http://adampresley.com/post/index.xml" title="RSS"></a>
        <p>&copy; 2016 &middot; Adam Presley. All Rights Reserved. Powered by <a href="http://gohugo.io">Hugo</a>.</p>
  </div>
</footer>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>window.jQuery || document.write('<script src="http:\/\/adampresley.com\/js/vendor/jquery-1.11.0.min.js"><\/script>')</script>
<script src="http://adampresley.com/js/plugins.js"></script>

<!-- Google Analytics -->
<script>
  var _gaq=[['_setAccount','UA-44927419-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>

