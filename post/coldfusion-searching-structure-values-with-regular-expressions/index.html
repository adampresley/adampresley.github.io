<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Adam.Blog()</title>
        <meta name="author">
        <meta name="description" content="I&#39;m bringin&#39; nerdy back">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="generator" content="Hugo 0.16-DEV" />
          <link href="http://adampresley.com/post/index.xml" rel="alternate" type="application/rss+xml" title="Adam.Blog()" />
          <link href="http://adampresley.com/post/index.xml" rel="feed" type="application/rss+xml" title="Adam.Blog()" />
        <link href='//fonts.googleapis.com/css?family=Roboto:400,300,700|Noto+Serif:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="http://adampresley.com/css/styles.css">
        <link rel="icon" href="http://adampresley.com/favicon.ico">
        <link rel="apple-touch-icon" href="http://adampresley.com/apple-touch-icon.png" />
        <link rel="stylesheet" href="http://adampresley.com/css/highlightjs/monokai.css">
        <script src="http://adampresley.com/js/vendor/modernizr-2.8.0.min.js"></script>
        <style>
        .site-header h2 .logo {
        background: url(http://adampresley.com/assets/images/code-background-screenshot.png) no-repeat 0 0;
        }
        @media (min--moz-device-pixel-ratio: 1.3), (-o-min-device-pixel-ratio: 2.6 / 2), (-webkit-min-device-pixel-ratio: 1.3), (min-device-pixel-ratio: 1.3), (min-resolution: 1.3dppx) {
          .site-header h2 .logo {
            background-image: url(http://adampresley.com/assets/images/code-background-screenshot.png);
        }}
       .site-header {
         background: #2a373d url(http://adampresley.com/assets/images/code-background-screenshot.png) no-repeat center center;
         z-index: -1;
        }
        </style>
    </head>
    <body>
        
        <header class="site-header">
          <div class="transparent-layer">
              <h2>Adam.Blog()</h2>
          </div>
        </header>


<div class="container clearfix">
    <main role="main" class="content">
        <article class="post">
            <a class="btn home" href="http://adampresley.com/" title="">&laquo; </a>
            
<h1><a href="http://adampresley.com/post/coldfusion-searching-structure-values-with-regular-expressions/" title="ColdFusion - Searching Structure Values with Regular Expressions">ColdFusion - Searching Structure Values with Regular Expressions</a></h1>

<footer class="post-info"> <span class="post-meta"><time datetime="2009.07.11">2009.07.11</time>

    &middot; 
        
        <a href="http://adampresley.com/tags/development">development</a>, 
        
        <a href="http://adampresley.com/tags/coldfusion">coldfusion</a>, 
        
        <a href="http://adampresley.com/tags/java">java</a>
        
    

</span>
</footer>

            <p>One of my favorite ColdFusion bloggers, Mr. Ben Nadel, blogged the other
day about creating a custom tag that would <a href="http://www.bennadel.com/blog/1635-restructfindvalue-adding-regular-expression-searching-to-structfindvalue-.htm">recursively traverse a
ColdFusion structure</a>
and search for values that match a regular expression search criteria.
I though this was a pretty cool idea and put his code in a test page to
start testing and playing with it. After giving it a try, and pusing the limits,
I came to the conclusion that this was a pretty cool idea, but under load the code started to run
pretty slow. In fact it made my CF server run out of memory at one point
with a very large structure (rougly 5,000 keys). Not one to back down
from a challenge, and make no mistake, getting this idea to run over a
5,000 key structure is a challenge, I decided to write a similar
function in Java to see if we could speed things up.</p>

<p>To get started we need to cover a few basics on the
ColdFusion data types under the hood. The first item of consideration is
that ColdFusion structures are actually a Java class named
<em>coldfusion.runtime.Struct</em>, based on the class
<em>coldfusion.util.FastHashtable</em>. Next we see that ColdFusion arrays are
based on the <em>java.util.Vector</em> class. The ColdFusion classes can be
found in a JAR file named cfusion.jar in <strong>/{CF8_INSTALL_DIR}/lib</strong>
Our Java JAR file will go here so it can be used in ColdFusion (yes,
restart is required).</p>

<p>The basic idea is we are going to create a method that will take a
ColdFusion structure and a regular expression search string, and it will
traverse the structure tree and return an array of structures that
contain the key, value, and the structure path to get to the values that
match your regular expression search. Here is such a piece of code.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">package</span> <span style="color: #f8f8f2">com.adampresley</span><span style="color: #f92672">;</span>

<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.util.*</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.lang.*</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.util.regex.*</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">coldfusion.util.*</span><span style="color: #f92672">;</span>

<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">class</span> <span style="color: #a6e22e">reStructTools</span> <span style="color: #66d9ef">extends</span> <span style="color: #f8f8f2">Object</span> <span style="color: #f92672">{</span>
    <span style="color: #66d9ef">private</span> <span style="color: #f8f8f2">Vector</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">fasthashtable</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">__searchValuesResult</span><span style="color: #f92672">;</span>
    <span style="color: #66d9ef">private</span> <span style="color: #f8f8f2">Vector</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">fasthashtable</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">__searchKeysResult</span><span style="color: #f92672">;</span>

    <span style="color: #75715e">/**</span>
<span style="color: #75715e">     * Constructor.</span>
<span style="color: #75715e">     * @author Adam Presley</span>
<span style="color: #75715e">     */</span>
    <span style="color: #66d9ef">public</span> <span style="color: #a6e22e">reStructTools</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>

    <span style="color: #f92672">}</span>

    <span style="color: #75715e">/**</span>
<span style="color: #75715e">     * Searches a structure for values that match the regular expression pattern.</span>
<span style="color: #75715e">     * @author Adam Presley</span>
<span style="color: #75715e">     * @param input ColdFusion structure to search.</span>
<span style="color: #75715e">     * @param searchPattern Regular expression search pattern.</span>
<span style="color: #75715e">     * @return Vector&lt;fasthashtable&gt;</span>
<span style="color: #75715e">     */</span>
    <span style="color: #66d9ef">public</span> <span style="color: #f8f8f2">Vector</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">fasthashtable</span><span style="color: #f92672">&gt;</span> <span style="color: #a6e22e">searchValues</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">FastHashtable</span> <span style="color: #f8f8f2">input</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">searchPattern</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
        <span style="color: #f8f8f2">Pattern</span> <span style="color: #f8f8f2">p</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Pattern</span><span style="color: #f92672">.</span><span style="color: #a6e22e">compile</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">searchPattern</span><span style="color: #f92672">);</span>

        <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">__searchValuesResult</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Vector</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">fasthashtable</span><span style="color: #f92672">&gt;();</span>
        <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">__searchValues</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">input</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">p</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;&quot;</span><span style="color: #f92672">);</span>

        <span style="color: #66d9ef">return</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">__searchValuesResult</span><span style="color: #f92672">;</span>
    <span style="color: #f92672">}</span>

    <span style="color: #75715e">/**</span>
<span style="color: #75715e">     * Searches a structure for keys whose name matches the regular expression pattern.</span>
<span style="color: #75715e">     * @author Adam Presley</span>
<span style="color: #75715e">     * @param input ColdFusion structure to search.</span>
<span style="color: #75715e">     * @param searchPattern Regular expression search pattern.</span>
<span style="color: #75715e">     * @return Vector&lt;fasthashtable&gt;</span>
<span style="color: #75715e">     */</span>
    <span style="color: #66d9ef">public</span> <span style="color: #f8f8f2">Vector</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">fasthashtable</span><span style="color: #f92672">&gt;</span> <span style="color: #a6e22e">searchKeys</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">FastHashtable</span> <span style="color: #f8f8f2">input</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">searchPattern</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
        <span style="color: #f8f8f2">Pattern</span> <span style="color: #f8f8f2">p</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Pattern</span><span style="color: #f92672">.</span><span style="color: #a6e22e">compile</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">searchPattern</span><span style="color: #f92672">);</span>

        <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">__searchKeysResult</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Vector</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">fasthashtable</span><span style="color: #f92672">&gt;();</span>
        <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">__searchKeys</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">input</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">p</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;&quot;</span><span style="color: #f92672">);</span>

        <span style="color: #66d9ef">return</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">__searchKeysResult</span><span style="color: #f92672">;</span>
    <span style="color: #f92672">}</span>

    <span style="color: #a6e22e">@SuppressWarnings</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;unchecked&quot;</span><span style="color: #f92672">)</span>
    <span style="color: #66d9ef">private</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">__searchValues</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">FastHashtable</span> <span style="color: #f8f8f2">input</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Pattern</span> <span style="color: #f8f8f2">searchPattern</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">startKey</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
        <span style="color: #f8f8f2">Enumeration</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">string</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">keys</span> <span style="color: #f92672">=</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">Enumeration</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">string</span><span style="color: #f92672">&gt;)</span> <span style="color: #f8f8f2">input</span><span style="color: #f92672">.</span><span style="color: #a6e22e">keys</span><span style="color: #f92672">();</span>
        <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;&quot;</span><span style="color: #f92672">;</span>
        <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">currentKey</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;[\&quot;&quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">startKey</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;\&quot;]&quot;</span><span style="color: #f92672">;</span>

        <span style="color: #f8f8f2">Object</span> <span style="color: #f8f8f2">value</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>
        <span style="color: #f8f8f2">Object</span> <span style="color: #f8f8f2">arrayValue</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>
        <span style="color: #f8f8f2">Matcher</span> <span style="color: #f8f8f2">m</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>

        <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">index</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span>
        <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">count</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span>

        <span style="color: #f8f8f2">FastHashtable</span> <span style="color: #f8f8f2">info</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>

        <span style="color: #66d9ef">while</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">keys</span><span style="color: #f92672">.</span><span style="color: #a6e22e">hasMoreElements</span><span style="color: #f92672">())</span> <span style="color: #f92672">{</span>
            <span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">keys</span><span style="color: #f92672">.</span><span style="color: #a6e22e">nextElement</span><span style="color: #f92672">();</span>
            <span style="color: #f8f8f2">value</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">input</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">key</span><span style="color: #f92672">);</span>

            <span style="color: #f8f8f2">currentKey</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">startKey</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;[\&quot;&quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">key</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;\&quot;]&quot;</span><span style="color: #f92672">;</span>

            <span style="color: #75715e">//</span>
            <span style="color: #75715e">// If we have a structure in our value, call back and search.</span>
            <span style="color: #75715e">//</span>
            <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">value</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getClass</span><span style="color: #f92672">().</span><span style="color: #a6e22e">getName</span><span style="color: #f92672">()</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;coldfusion.runtime.Struct&quot;</span> <span style="color: #f92672">||</span> <span style="color: #f8f8f2">value</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getClass</span><span style="color: #f92672">().</span><span style="color: #a6e22e">getName</span><span style="color: #f92672">()</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;coldfusion.util.FastHashtable&quot;</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
                <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">__searchValues</span><span style="color: #f92672">((</span><span style="color: #f8f8f2">FastHashtable</span><span style="color: #f92672">)</span> <span style="color: #f8f8f2">value</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">searchPattern</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">currentKey</span><span style="color: #f92672">);</span>
            <span style="color: #f92672">}</span>

            <span style="color: #75715e">//</span>
            <span style="color: #75715e">// If our value is an array, iterate and search.</span>
            <span style="color: #75715e">//</span>
            <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">value</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getClass</span><span style="color: #f92672">().</span><span style="color: #a6e22e">getName</span><span style="color: #f92672">()</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;coldfusion.runtime.Array&quot;</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
                <span style="color: #f8f8f2">count</span> <span style="color: #f92672">=</span> <span style="color: #f92672">((</span><span style="color: #f8f8f2">Vector</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">object</span><span style="color: #f92672">&gt;)</span> <span style="color: #f8f8f2">value</span><span style="color: #f92672">).</span><span style="color: #a6e22e">size</span><span style="color: #f92672">();</span>

                <span style="color: #66d9ef">for</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">index</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">index</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">count</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">index</span><span style="color: #f92672">++)</span> <span style="color: #f92672">{</span>
                    <span style="color: #f8f8f2">arrayValue</span> <span style="color: #f92672">=</span> <span style="color: #f92672">((</span><span style="color: #f8f8f2">Vector</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">object</span><span style="color: #f92672">&gt;)</span> <span style="color: #f8f8f2">value</span><span style="color: #f92672">).</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">index</span><span style="color: #f92672">);</span>

                    <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">arrayValue</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getClass</span><span style="color: #f92672">().</span><span style="color: #a6e22e">getName</span><span style="color: #f92672">()</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;coldfusion.runtime.Struct&quot;</span> <span style="color: #f92672">||</span> <span style="color: #f8f8f2">arrayValue</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getClass</span><span style="color: #f92672">().</span><span style="color: #a6e22e">getName</span><span style="color: #f92672">()</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;coldfusion.util.FastHashtable&quot;</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
                        <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">tempKey</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">currentKey</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;[&quot;</span> <span style="color: #f92672">+</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">index</span> <span style="color: #f92672">+</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">)</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;]&quot;</span><span style="color: #f92672">;</span>
                        <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">__searchValues</span><span style="color: #f92672">((</span><span style="color: #f8f8f2">FastHashtable</span><span style="color: #f92672">)</span> <span style="color: #f8f8f2">arrayValue</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">searchPattern</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">tempKey</span><span style="color: #f92672">);</span>
                    <span style="color: #f92672">}</span>
                <span style="color: #f92672">}</span>
            <span style="color: #f92672">}</span>

            <span style="color: #75715e">//</span>
            <span style="color: #75715e">// Match the pattern.</span>
            <span style="color: #75715e">//</span>
            <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">value</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getClass</span><span style="color: #f92672">().</span><span style="color: #a6e22e">getName</span><span style="color: #f92672">()</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;java.lang.String&quot;</span> <span style="color: #f92672">||</span> <span style="color: #f8f8f2">value</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getClass</span><span style="color: #f92672">().</span><span style="color: #a6e22e">getName</span><span style="color: #f92672">()</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;java.lang.Double&quot;</span> <span style="color: #f92672">||</span> <span style="color: #f8f8f2">value</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getClass</span><span style="color: #f92672">().</span><span style="color: #a6e22e">getName</span><span style="color: #f92672">()</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;java.lang.Integer&quot;</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
                <span style="color: #f8f8f2">m</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">searchPattern</span><span style="color: #f92672">.</span><span style="color: #a6e22e">matcher</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">value</span><span style="color: #f92672">.</span><span style="color: #a6e22e">toString</span><span style="color: #f92672">());</span>

                <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">m</span><span style="color: #f92672">.</span><span style="color: #a6e22e">matches</span><span style="color: #f92672">())</span> <span style="color: #f92672">{</span>
                    <span style="color: #f8f8f2">info</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">FastHashtable</span><span style="color: #f92672">();</span>

                    <span style="color: #f8f8f2">info</span><span style="color: #f92672">.</span><span style="color: #a6e22e">put</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;key&quot;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">key</span><span style="color: #f92672">);</span>
                    <span style="color: #f8f8f2">info</span><span style="color: #f92672">.</span><span style="color: #a6e22e">put</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;value&quot;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">value</span><span style="color: #f92672">);</span>
                    <span style="color: #f8f8f2">info</span><span style="color: #f92672">.</span><span style="color: #a6e22e">put</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;path&quot;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">currentKey</span><span style="color: #f92672">);</span>

                    <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">__searchValuesResult</span><span style="color: #f92672">.</span><span style="color: #a6e22e">add</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">info</span><span style="color: #f92672">);</span>
                <span style="color: #f92672">}</span>
            <span style="color: #f92672">}</span>
        <span style="color: #f92672">}</span>
    <span style="color: #f92672">}</span>

    <span style="color: #a6e22e">@SuppressWarnings</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;unchecked&quot;</span><span style="color: #f92672">)</span>
    <span style="color: #66d9ef">private</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">__searchKeys</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">FastHashtable</span> <span style="color: #f8f8f2">input</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Pattern</span> <span style="color: #f8f8f2">searchPattern</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">startKey</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
        <span style="color: #f8f8f2">Enumeration</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">string</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">keys</span> <span style="color: #f92672">=</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">Enumeration</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">string</span><span style="color: #f92672">&gt;)</span> <span style="color: #f8f8f2">input</span><span style="color: #f92672">.</span><span style="color: #a6e22e">keys</span><span style="color: #f92672">();</span>
        <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;&quot;</span><span style="color: #f92672">;</span>
        <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">currentKey</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;[\&quot;&quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">startKey</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;\&quot;]&quot;</span><span style="color: #f92672">;</span>

        <span style="color: #f8f8f2">Object</span> <span style="color: #f8f8f2">value</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>
        <span style="color: #f8f8f2">Object</span> <span style="color: #f8f8f2">arrayValue</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>
        <span style="color: #f8f8f2">Matcher</span> <span style="color: #f8f8f2">m</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>

        <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">index</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span>
        <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">count</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span>

        <span style="color: #f8f8f2">FastHashtable</span> <span style="color: #f8f8f2">info</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>

        <span style="color: #66d9ef">while</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">keys</span><span style="color: #f92672">.</span><span style="color: #a6e22e">hasMoreElements</span><span style="color: #f92672">())</span> <span style="color: #f92672">{</span>
            <span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">keys</span><span style="color: #f92672">.</span><span style="color: #a6e22e">nextElement</span><span style="color: #f92672">();</span>
            <span style="color: #f8f8f2">value</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">input</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">key</span><span style="color: #f92672">);</span>

            <span style="color: #f8f8f2">currentKey</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">startKey</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;[\&quot;&quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">key</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;\&quot;]&quot;</span><span style="color: #f92672">;</span>

            <span style="color: #75715e">//</span>
            <span style="color: #75715e">// If we have a structure in our value, call back and search.</span>
            <span style="color: #75715e">//</span>
            <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">value</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getClass</span><span style="color: #f92672">().</span><span style="color: #a6e22e">getName</span><span style="color: #f92672">()</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;coldfusion.runtime.Struct&quot;</span> <span style="color: #f92672">||</span> <span style="color: #f8f8f2">value</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getClass</span><span style="color: #f92672">().</span><span style="color: #a6e22e">getName</span><span style="color: #f92672">()</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;coldfusion.util.FastHashtable&quot;</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
                <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">__searchKeys</span><span style="color: #f92672">((</span><span style="color: #f8f8f2">FastHashtable</span><span style="color: #f92672">)</span> <span style="color: #f8f8f2">value</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">searchPattern</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">currentKey</span><span style="color: #f92672">);</span>
            <span style="color: #f92672">}</span>

            <span style="color: #75715e">//</span>
            <span style="color: #75715e">// If our value is an array, iterate and search.</span>
            <span style="color: #75715e">//</span>
            <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">value</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getClass</span><span style="color: #f92672">().</span><span style="color: #a6e22e">getName</span><span style="color: #f92672">()</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;coldfusion.runtime.Array&quot;</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
                <span style="color: #f8f8f2">count</span> <span style="color: #f92672">=</span> <span style="color: #f92672">((</span><span style="color: #f8f8f2">Vector</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">object</span><span style="color: #f92672">&gt;)</span> <span style="color: #f8f8f2">value</span><span style="color: #f92672">).</span><span style="color: #a6e22e">size</span><span style="color: #f92672">();</span>

                <span style="color: #66d9ef">for</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">index</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">index</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">count</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">index</span><span style="color: #f92672">++)</span> <span style="color: #f92672">{</span>
                    <span style="color: #f8f8f2">arrayValue</span> <span style="color: #f92672">=</span> <span style="color: #f92672">((</span><span style="color: #f8f8f2">Vector</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">object</span><span style="color: #f92672">&gt;)</span> <span style="color: #f8f8f2">value</span><span style="color: #f92672">).</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">index</span><span style="color: #f92672">);</span>

                    <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">arrayValue</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getClass</span><span style="color: #f92672">().</span><span style="color: #a6e22e">getName</span><span style="color: #f92672">()</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;coldfusion.runtime.Struct&quot;</span> <span style="color: #f92672">||</span> <span style="color: #f8f8f2">arrayValue</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getClass</span><span style="color: #f92672">().</span><span style="color: #a6e22e">getName</span><span style="color: #f92672">()</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;coldfusion.util.FastHashtable&quot;</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
                        <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">tempKey</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">currentKey</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;[&quot;</span> <span style="color: #f92672">+</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">index</span> <span style="color: #f92672">+</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">)</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;]&quot;</span><span style="color: #f92672">;</span>
                        <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">__searchKeys</span><span style="color: #f92672">((</span><span style="color: #f8f8f2">FastHashtable</span><span style="color: #f92672">)</span> <span style="color: #f8f8f2">arrayValue</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">searchPattern</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">tempKey</span><span style="color: #f92672">);</span>
                    <span style="color: #f92672">}</span>
                <span style="color: #f92672">}</span>
            <span style="color: #f92672">}</span>

            <span style="color: #75715e">//</span>
            <span style="color: #75715e">// Match the pattern.</span>
            <span style="color: #75715e">//</span>
            <span style="color: #f8f8f2">m</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">searchPattern</span><span style="color: #f92672">.</span><span style="color: #a6e22e">matcher</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">key</span><span style="color: #f92672">);</span>

            <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">m</span><span style="color: #f92672">.</span><span style="color: #a6e22e">matches</span><span style="color: #f92672">())</span> <span style="color: #f92672">{</span>
                <span style="color: #f8f8f2">info</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">FastHashtable</span><span style="color: #f92672">();</span>

                <span style="color: #f8f8f2">info</span><span style="color: #f92672">.</span><span style="color: #a6e22e">put</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;key&quot;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">key</span><span style="color: #f92672">);</span>
                <span style="color: #f8f8f2">info</span><span style="color: #f92672">.</span><span style="color: #a6e22e">put</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;path&quot;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">currentKey</span><span style="color: #f92672">);</span>

                <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">__searchKeysResult</span><span style="color: #f92672">.</span><span style="color: #a6e22e">add</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">info</span><span style="color: #f92672">);</span>
            <span style="color: #f92672">}</span>
        <span style="color: #f92672">}</span>
    <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>


<p>The real worker here is the method <strong>__searchValues</strong>. Basically it
starts by getting all of the structure&rsquo;s keys and iterates over them. To
get a structure path we keep up with where we are currently at in a
variable called <em>currentKey</em>. The next task is to determine if the value
of the current key is a structure, because if it is we need to call the
<strong>__searchValues</strong> method recursively passing the value as the next
structure to search. If the value is an array, we wish to start
iterating over this array, and once again check the value to see if it
is a structure that needs to be traversed.</p>

<p>If the value is a simple type we want to try and match it against our
regular expression search criteria. Once we have a match we will take
the current key, value, and path information we&rsquo;ve been tracking, put it
in a structure, and add it to the result array that will eventually get
back to the user.</p>

<p>For a test case I put together code that creates a structure exactly
like Mr. Nadel&rsquo;s, and executes the Java based search method, and his CF
based search method, timing each one. Below you will find the code for this test.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">cfsetting</span> <span style="color: #a6e22e">requesttimeout</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;300&quot;</span><span style="color: #f8f8f2">&gt;</span>

<span style="color: #75715e">&lt;!---</span>
<span style="color: #75715e">    Ben Nadel&#39;s reStructFindValue method.</span>
<span style="color: #75715e">---&gt;</span>
<span style="color: #f8f8f2">&lt;cffunction</span>
    <span style="color: #f8f8f2">name</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;reStructFindValue&quot;</span>
    <span style="color: #f8f8f2">access</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;public&quot;</span>
    <span style="color: #f8f8f2">returntype</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;array&quot;</span>
    <span style="color: #f8f8f2">output</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;false&quot;</span>
    <span style="color: #f8f8f2">hint</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;I search for patterns within a given &quot;</span><span style="color: #f8f8f2">&gt;</span>

    <span style="color: #75715e">&lt;!--- Define arguments. ---&gt;</span>
    <span style="color: #f8f8f2">&lt;cfargument</span>
        <span style="color: #f8f8f2">name</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;target&quot;</span>
        <span style="color: #f8f8f2">type</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;any&quot;</span>
        <span style="color: #66d9ef">required</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;true&quot;</span>
        <span style="color: #f8f8f2">hint</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;I am the target struct being searched.&quot;</span>
        <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

    <span style="color: #f8f8f2">&lt;cfargument</span>
        <span style="color: #f8f8f2">name</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;pattern&quot;</span>
        <span style="color: #f8f8f2">type</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;string&quot;</span>
        <span style="color: #66d9ef">required</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;true&quot;</span>
        <span style="color: #f8f8f2">hint</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;I am the pattern being searched.&quot;</span>
        <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

    <span style="color: #f8f8f2">&lt;cfargument</span>
        <span style="color: #f8f8f2">name</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;scope&quot;</span>
        <span style="color: #f8f8f2">type</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;string&quot;</span>
        <span style="color: #66d9ef">required</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;false&quot;</span>
        <span style="color: #66d9ef">default</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;one&quot;</span>
        <span style="color: #f8f8f2">hint</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;I am the scope of the search: one or all.&quot;</span>
        <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

    <span style="color: #f8f8f2">&lt;cfargument</span>
        <span style="color: #f8f8f2">name</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;path&quot;</span>
        <span style="color: #f8f8f2">type</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;string&quot;</span>
        <span style="color: #66d9ef">required</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;false&quot;</span>
        <span style="color: #66d9ef">default</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;&quot;</span>
        <span style="color: #f8f8f2">hint</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;The path to the current target (for recursive calling). ** NOTE: This is used internally for recursion - this is NOT an expected argument to be passed in by the user.&quot;</span>
        <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

    <span style="color: #75715e">&lt;!--- Define the local scope. ---&gt;</span>
    <span style="color: #f8f8f2">&lt;cfset</span> <span style="color: #66d9ef">var</span> <span style="color: #f8f8f2">local</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">{}</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

    <span style="color: #75715e">&lt;!--- Create an array ---&gt;</span>
    <span style="color: #f8f8f2">&lt;cfset</span> <span style="color: #f8f8f2">local.results</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[]</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

    <span style="color: #75715e">&lt;!---</span>
<span style="color: #75715e">        Loop over target.</span>
<span style="color: #75715e">        NOTE: This uses a ColdFusion custom tag that unifies</span>
<span style="color: #75715e">        the interface for looping over both structure and</span>
<span style="color: #75715e">        arrays.</span>
<span style="color: #75715e">        http://www.bennadel.com/go/each-iteration</span>
<span style="color: #75715e">    ---&gt;</span>
    <span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">cf_each</span>
        <span style="color: #a6e22e">item</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;local.item&quot;</span>
        <span style="color: #a6e22e">collection</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;#arguments.target#&quot;</span><span style="color: #f8f8f2">&gt;</span>

        <span style="color: #75715e">&lt;!--- Create a variable to store the base path. ---&gt;</span>
        <span style="color: #f8f8f2">&lt;cfset</span> <span style="color: #f8f8f2">local.path</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">arguments</span><span style="color: #f8f8f2">.path</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

        <span style="color: #75715e">&lt;!--- Add the current key to the path. ---&gt;</span>
        <span style="color: #f8f8f2">&lt;cfset</span> <span style="color: #f8f8f2">local.path</span> <span style="color: #f92672">&amp;=</span> <span style="color: #e6db74">&quot;[ &quot;&quot;#local.item.key#&quot;&quot; ]&quot;</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

        <span style="color: #75715e">&lt;!--- Get a handle on the new target. ---&gt;</span>
        <span style="color: #f8f8f2">&lt;cfset</span> <span style="color: #f8f8f2">local.target</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">local.item.value</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

        <span style="color: #75715e">&lt;!---</span>
<span style="color: #75715e">            Check to see if this new target is a string (or</span>
<span style="color: #75715e">            if it is another complex object that we need to</span>
<span style="color: #75715e">            iterate over).</span>
<span style="color: #75715e">        ---&gt;</span>
        <span style="color: #f8f8f2">&lt;cfif</span> <span style="color: #a6e22e">isSimpleValue</span><span style="color: #f8f8f2">(</span> <span style="color: #f8f8f2">local.target</span> <span style="color: #f8f8f2">)&gt;</span>

        <span style="color: #75715e">&lt;!---</span>
<span style="color: #75715e">            Check it for the pattern match on the target</span>
<span style="color: #75715e">            value. For now, we are going to be using</span>
<span style="color: #75715e">            ColdFusion&#39;s Match() method which means a sub</span>
<span style="color: #75715e">            set of regular expression usage. Furthermore,</span>
<span style="color: #75715e">            we are going to use NoCASE for each of coding.</span>
<span style="color: #75715e">        ---&gt;</span>
        <span style="color: #f8f8f2">&lt;cfif</span> <span style="color: #a6e22e">arrayLen</span><span style="color: #f8f8f2">(</span> <span style="color: #a6e22e">reMatchNoCase</span><span style="color: #f8f8f2">(</span> <span style="color: #66d9ef">arguments</span><span style="color: #f8f8f2">.pattern,</span> <span style="color: #f8f8f2">local.target</span> <span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">)&gt;</span>

            <span style="color: #75715e">&lt;!---</span>
<span style="color: #75715e">                The regular expression patther was found at</span>
<span style="color: #75715e">                least once in the target value. This is a</span>
<span style="color: #75715e">                valid match. Add it to the results.</span>
<span style="color: #75715e">            ---&gt;</span>
            <span style="color: #f8f8f2">&lt;cfset</span> <span style="color: #f8f8f2">local.result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">{</span>
                <span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">local.item.key,</span>
                <span style="color: #f8f8f2">owner</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">arguments</span><span style="color: #f8f8f2">.target,</span>
                <span style="color: #f8f8f2">path</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">local.path</span>
            <span style="color: #f8f8f2">}</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

            <span style="color: #75715e">&lt;!--- Add this result to the current results. ---&gt;</span>
            <span style="color: #f8f8f2">&lt;cfset</span> <span style="color: #a6e22e">arrayAppend</span><span style="color: #f8f8f2">(</span> <span style="color: #f8f8f2">local.results,</span> <span style="color: #f8f8f2">local.result</span> <span style="color: #f8f8f2">)</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

        <span style="color: #f8f8f2">&lt;/cfif&gt;</span>

        <span style="color: #75715e">&lt;!---</span>
<span style="color: #75715e">            Make sure this complex nested target is one that</span>
<span style="color: #75715e">            we can actually iterate over (all others will be</span>
<span style="color: #75715e">            skipped).</span>
<span style="color: #75715e">        ---&gt;</span>
        <span style="color: #f8f8f2">&lt;cfelseif</span> <span style="color: #f8f8f2">(</span>
            <span style="color: #a6e22e">isStruct</span><span style="color: #f8f8f2">(</span> <span style="color: #f8f8f2">local.target</span> <span style="color: #f8f8f2">)</span> <span style="color: #f92672">||</span>
            <span style="color: #a6e22e">isArray</span><span style="color: #f8f8f2">(</span> <span style="color: #f8f8f2">local.target</span> <span style="color: #f8f8f2">)</span>
        <span style="color: #f8f8f2">)&gt;</span>

            <span style="color: #75715e">&lt;!---</span>
<span style="color: #75715e">                The nested taret is not a simple value. Therefore,</span>
<span style="color: #75715e">                we need to perform a depth-first, recusive search</span>
<span style="color: #75715e">                of it for our matching pattern.</span>
<span style="color: #75715e">            ---&gt;</span>
            <span style="color: #f8f8f2">&lt;cfset</span> <span style="color: #f8f8f2">local.childResults</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">reStructFindValue</span><span style="color: #f8f8f2">(</span>
                <span style="color: #f8f8f2">local.target,</span>
                <span style="color: #66d9ef">arguments</span><span style="color: #f8f8f2">.pattern,</span>
                <span style="color: #66d9ef">arguments</span><span style="color: #f8f8f2">.scope,</span>
                <span style="color: #f8f8f2">local.path</span>
            <span style="color: #f8f8f2">)</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

            <span style="color: #75715e">&lt;!---</span>
<span style="color: #75715e">                Add the results from our nested search to the</span>
<span style="color: #75715e">                current results collection.</span>
<span style="color: #75715e">            ---&gt;</span>
            <span style="color: #f8f8f2">&lt;cfloop</span>
                <span style="color: #f8f8f2">index</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;local.childResult&quot;</span>
                <span style="color: #66d9ef">array</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;#local.childResults#&quot;</span><span style="color: #f8f8f2">&gt;</span>

                <span style="color: #75715e">&lt;!--- Add this result to the current results. ---&gt;</span>
                <span style="color: #f8f8f2">&lt;cfset</span> <span style="color: #a6e22e">arrayAppend</span><span style="color: #f8f8f2">(</span> <span style="color: #f8f8f2">local.results,</span> <span style="color: #f8f8f2">local.childResult</span> <span style="color: #f8f8f2">)</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

            <span style="color: #f8f8f2">&lt;/cfloop&gt;</span>

        <span style="color: #f8f8f2">&lt;/cfif&gt;</span>


        <span style="color: #75715e">&lt;!---</span>
<span style="color: #75715e">            At the end of a single iteration, let&#39;s check to see</span>
<span style="color: #75715e">            if we were only searching for one target. If we are,</span>
<span style="color: #75715e">            AND we found it, we can simply return the single</span>
<span style="color: #75715e">            element rather than continuing on with our recursion.</span>
<span style="color: #75715e">        ---&gt;</span>
        <span style="color: #f8f8f2">&lt;cfif</span> <span style="color: #f8f8f2">(</span>
            <span style="color: #f8f8f2">(</span><span style="color: #66d9ef">arguments</span><span style="color: #f8f8f2">.scope</span> <span style="color: #f92672">eq</span> <span style="color: #e6db74">&quot;one&quot;</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">&amp;&amp;</span>
            <span style="color: #a6e22e">arrayLen</span><span style="color: #f8f8f2">(</span> <span style="color: #f8f8f2">local.results</span> <span style="color: #f8f8f2">)</span>
        <span style="color: #f8f8f2">)&gt;</span>

            <span style="color: #75715e">&lt;!---</span>
<span style="color: #75715e">            We found at least one item - trim the results</span>
<span style="color: #75715e">            set in case the last iteration found more than</span>
<span style="color: #75715e">            one.</span>
<span style="color: #75715e">            ---&gt;</span>
            <span style="color: #f8f8f2">&lt;cfset</span> <span style="color: #f8f8f2">local.trimmedResults</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[</span> <span style="color: #f8f8f2">local.results[</span> <span style="color: #ae81ff">1</span> <span style="color: #f8f8f2">]</span> <span style="color: #f8f8f2">]</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

            <span style="color: #75715e">&lt;!--- Return the trimmed result set. ---&gt;</span>
            <span style="color: #f8f8f2">&lt;cfreturn</span> <span style="color: #f8f8f2">local.trimmedResults</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

        <span style="color: #f8f8f2">&lt;/cfif&gt;</span>

    <span style="color: #f8f8f2">&lt;/</span><span style="color: #f92672">cf_each</span><span style="color: #f8f8f2">&gt;</span>


    <span style="color: #75715e">&lt;!--- Return the found results. ---&gt;</span>
    <span style="color: #f8f8f2">&lt;cfreturn</span> <span style="color: #f8f8f2">local.results</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>
<span style="color: #f8f8f2">&lt;/cffunction&gt;</span>

<span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">cftimer</span> <span style="color: #a6e22e">label</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;Getting Structure Setup&quot;</span> <span style="color: #a6e22e">type</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;inline&quot;</span><span style="color: #f8f8f2">&gt;</span>
    <span style="color: #f8f8f2">&lt;cfset</span> <span style="color: #f8f8f2">myData</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #f8f8f2">hotGirls</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[</span>
            <span style="color: #f8f8f2">{</span>
                <span style="color: #f8f8f2">name</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Tricia&quot;</span><span style="color: #f8f8f2">,</span>
                <span style="color: #f8f8f2">hair</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Brunette&quot;</span>
            <span style="color: #f8f8f2">},</span>
            <span style="color: #f8f8f2">{</span>
                <span style="color: #f8f8f2">name</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Kim&quot;</span><span style="color: #f8f8f2">,</span>
                <span style="color: #f8f8f2">hair</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Blonde&quot;</span>
            <span style="color: #f8f8f2">}</span>
        <span style="color: #f8f8f2">],</span>
        <span style="color: #f8f8f2">athleticGirls</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[</span>
            <span style="color: #f8f8f2">{</span>
                <span style="color: #f8f8f2">name</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Tricia&quot;</span><span style="color: #f8f8f2">,</span>
                <span style="color: #f8f8f2">hair</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Brunette&quot;</span>
            <span style="color: #f8f8f2">},</span>
            <span style="color: #f8f8f2">{</span>
                <span style="color: #f8f8f2">name</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Jen&quot;</span><span style="color: #f8f8f2">,</span>
                <span style="color: #f8f8f2">hair</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Black&quot;</span>
            <span style="color: #f8f8f2">}</span>
        <span style="color: #f8f8f2">]</span>
    <span style="color: #f8f8f2">}</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

    <span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">strong</span><span style="color: #f8f8f2">&gt;</span>Original Structure:<span style="color: #f8f8f2">&lt;/</span><span style="color: #f92672">strong</span><span style="color: #f8f8f2">&gt;</span>
    <span style="color: #f8f8f2">&lt;cfdump</span> <span style="color: #66d9ef">var</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;#myData#&quot;</span> <span style="color: #f8f8f2">expand</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;true&quot;</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

<span style="color: #f8f8f2">&lt;/</span><span style="color: #f92672">cftimer</span><span style="color: #f8f8f2">&gt;</span>





<span style="color: #f8f8f2">&lt;cfoutput&gt;</span>

<span style="color: #75715e">&lt;!---</span>
<span style="color: #75715e">    Test the speed of searching values using ReStructTools</span>
<span style="color: #75715e">---&gt;</span>
<span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">cftimer</span> <span style="color: #a6e22e">label</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;ReStructTools&quot;</span> <span style="color: #a6e22e">type</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;inline&quot;</span><span style="color: #f8f8f2">&gt;</span>
    <span style="color: #f8f8f2">&lt;cfset</span> <span style="color: #f8f8f2">structTools</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">createObject</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;java&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;com.adampresley.reStructTools&quot;</span><span style="color: #f8f8f2">).</span><span style="color: #a6e22e">init</span><span style="color: #f8f8f2">()</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

    <span style="color: #f8f8f2">&lt;cfset</span> <span style="color: #f8f8f2">pattern1</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;(?i)brunette|brown|black&quot;</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>
    <span style="color: #f8f8f2">&lt;cfset</span> <span style="color: #f8f8f2">result1</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">structTools.searchValues</span><span style="color: #f8f8f2">(myData,</span> <span style="color: #f8f8f2">pattern1)</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

    <span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">strong</span><span style="color: #f8f8f2">&gt;</span>Find Values: <span style="color: #f8f8f2">#pattern1#&lt;/</span><span style="color: #f92672">strong</span><span style="color: #f8f8f2">&gt;</span>
    <span style="color: #f8f8f2">&lt;cfdump</span> <span style="color: #66d9ef">var</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;#result1#&quot;</span> <span style="color: #f8f8f2">expand</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;false&quot;</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>
<span style="color: #f8f8f2">&lt;/</span><span style="color: #f92672">cftimer</span><span style="color: #f8f8f2">&gt;</span>


<span style="color: #75715e">&lt;!---</span>
<span style="color: #75715e">    Test the speed of searching values using reStructFindValue</span>
<span style="color: #75715e">---&gt;</span>
<span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">cftimer</span> <span style="color: #a6e22e">label</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;Ben Nadel&#39;s reStructFindValue&quot;</span> <span style="color: #a6e22e">type</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;inline&quot;</span><span style="color: #f8f8f2">&gt;</span>
    <span style="color: #f8f8f2">&lt;cfset</span> <span style="color: #f8f8f2">pattern1</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;brunette|brown|black&quot;</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>
    <span style="color: #f8f8f2">&lt;cfset</span> <span style="color: #f8f8f2">result2</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">reStructFindValue</span><span style="color: #f8f8f2">(myData,</span> <span style="color: #f8f8f2">pattern1,</span> <span style="color: #e6db74">&quot;all&quot;</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>

    <span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">strong</span><span style="color: #f8f8f2">&gt;</span>Find Values: <span style="color: #f8f8f2">#pattern1#&lt;/</span><span style="color: #f92672">strong</span><span style="color: #f8f8f2">&gt;</span>
    <span style="color: #f8f8f2">&lt;cfdump</span> <span style="color: #66d9ef">var</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;#result2#&quot;</span> <span style="color: #f8f8f2">expand</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;false&quot;</span> <span style="color: #f92672">/</span><span style="color: #f8f8f2">&gt;</span>
<span style="color: #f8f8f2">&lt;/</span><span style="color: #f92672">cftimer</span><span style="color: #f8f8f2">&gt;</span>

<span style="color: #f8f8f2">&lt;/cfoutput&gt;</span>
</pre></div>
</p>

<p>Happy coding!</p>

            <ul class="share-buttons">
    <li></li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fadampresley.com%2fpost%2fcoldfusion-searching-structure-values-with-regular-expressions%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=ColdFusion%20-%20Searching%20Structure%20Values%20with%20Regular%20Expressions&amp;url=http%3a%2f%2fadampresley.com%2fpost%2fcoldfusion-searching-structure-values-with-regular-expressions%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-gplus" href="https://plus.google.com/share?url=http%3a%2f%2fadampresley.com%2fpost%2fcoldfusion-searching-structure-values-with-regular-expressions%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fadampresley.com%2fpost%2fcoldfusion-searching-structure-values-with-regular-expressions%2f&title=ColdFusion%20-%20Searching%20Structure%20Values%20with%20Regular%20Expressions" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title=""></a>
    </li>
</ul>

        </article>
        <div class="comments">
            <h3></h3>
            <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'adampresleyblog';
    var disqus_identifier = 'http:\/\/adampresley.com\/post\/coldfusion-searching-structure-values-with-regular-expressions\/';
    var disqus_title = 'ColdFusion - Searching Structure Values with Regular Expressions';
    var disqus_url = 'http:\/\/adampresley.com\/post\/coldfusion-searching-structure-values-with-regular-expressions\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    </main>
    <aside class="author">
  <img class="profile-image" src="http://adampresley.com/assets/adampresley/images/adam-bowtie.png" alt="Adam Presley" />
  <p class="name"> 
  <strong>Adam Presley</strong></p>
  <p class="address">Texas, USA</p>
  <p class="link"></p>
  <ul class="social">
    
<li><a href="//twitter.com/adampresley" class="icon-twitter" target="_blank" title="Twitter"></a></li>













<li><a href="//github.com/adampresley" class="icon-github" target="_blank" title="Github"></a></li>




<li><a href="http://adampresley.com/post/index.xml" class="icon-rss" target="_blank" title="RSS"></a></li>

  </ul>
  <br><br>
</aside>

</div>

<footer class="main-footer">
  <div class="container clearfix">
        <a class="icon-rss" href="http://adampresley.com/post/index.xml" title="RSS"></a>
        <p>&copy; 2016 &middot; Adam Presley. All Rights Reserved. Powered by <a href="http://gohugo.io">Hugo</a>.</p>
  </div>
</footer>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>window.jQuery || document.write('<script src="http:\/\/adampresley.com\/js/vendor/jquery-1.11.0.min.js"><\/script>')</script>
<script src="http://adampresley.com/js/plugins.js"></script>

<!-- Google Analytics -->
<script>
  var _gaq=[['_setAccount','UA-44927419-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>

