<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Adam.Blog()</title>
        <meta name="author">
        <meta name="description" content="I&#39;m bringin&#39; nerdy back">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="generator" content="Hugo 0.16-DEV" />
          <link href="http://adampresley.com/post/index.xml" rel="alternate" type="application/rss+xml" title="Adam.Blog()" />
          <link href="http://adampresley.com/post/index.xml" rel="feed" type="application/rss+xml" title="Adam.Blog()" />
        <link href='//fonts.googleapis.com/css?family=Roboto:400,300,700|Noto+Serif:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="http://adampresley.com/css/styles.css">
        <link rel="icon" href="http://adampresley.com/favicon.ico">
        <link rel="apple-touch-icon" href="http://adampresley.com/apple-touch-icon.png" />
        <link rel="stylesheet" href="http://adampresley.com/css/highlightjs/monokai.css">
        <script src="http://adampresley.com/js/vendor/modernizr-2.8.0.min.js"></script>
        <style>
        .site-header h2 .logo {
        background: url(http://adampresley.com/assets/images/code-background-screenshot.png) no-repeat 0 0;
        }
        @media (min--moz-device-pixel-ratio: 1.3), (-o-min-device-pixel-ratio: 2.6 / 2), (-webkit-min-device-pixel-ratio: 1.3), (min-device-pixel-ratio: 1.3), (min-resolution: 1.3dppx) {
          .site-header h2 .logo {
            background-image: url(http://adampresley.com/assets/images/code-background-screenshot.png);
        }}
       .site-header {
         background: #2a373d url(http://adampresley.com/assets/images/code-background-screenshot.png) no-repeat center center;
         z-index: -1;
        }
        </style>
    </head>
    <body>
        
        <header class="site-header">
          <div class="transparent-layer">
              <h2>Adam.Blog()</h2>
          </div>
        </header>


<div class="container clearfix">
    <main role="main" class="content">
        <article class="post">
            <a class="btn home" href="http://adampresley.com/" title="">&laquo; </a>
            
<h1><a href="http://adampresley.com/post/intro-to-dsls-in-groovy-part-3/" title="Intro to DSLs in Groovy, Part 3">Intro to DSLs in Groovy, Part 3</a></h1>

<footer class="post-info"> <span class="post-meta"><time datetime="2011.03.27">2011.03.27</time>

    &middot; 
        
        <a href="http://adampresley.com/tags/development">development</a>, 
        
        <a href="http://adampresley.com/tags/groovy">groovy</a>, 
        
        <a href="http://adampresley.com/tags/dsl">dsl</a>
        
    

</span>
</footer>

            

<p>Today let&rsquo;s continue our series of getting started with simple DSL
creation in Groovy. In <a href="|filename|/intro-to-dsls-in-groovy-part-1.md">part 1</a> we talked about the <em>what</em> and <em>why</em>
of Domain Specific Langages, and what our sample DSL would look like.
Then in <a href="|filename|/intro-to-dsls-in-groovy-part-2.md">part 2</a> we actually started building the code in Groovy
creating the class necessary to make the DSL code start to work. In part
3 we will enhance our code to allow us to add ingredients with
measurements. Adding this will make the DSL more fluent and readable,
which is one of the main reasons you would bother to craft a DSL to
begin with!</p>

<p>If you&rsquo;ve read my blog before you will have seen me talk about and
demonstrate how one can expand the capabilities of the existing Groovy
language though metaClass enhancements. I hope you were paying attention
because we are going to use them again. For our purposes we want to
enhance all number classes to be able to specify a unit of measurement
against it, which we will use later when displaying our recipe in
various output formats. So, as an example if our recipe called for 1 and
half cups of cheese, it could be written like <strong>1.5.cups</strong>. We also wish
to ensure that all number classes get this, so our metaClass enhancement
needs to apply down the hierarchy. When a unit of measurement is applied
to a number, instead of returning an actual number class, we will
instead create a new Measurement class that will be returned in its
place.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">/*</span>
<span style="color: #75715e"> * Ensure that changes to base classes through metaClass</span>
<span style="color: #75715e"> * expand downwards.</span>
<span style="color: #75715e"> */</span>
<span style="color: #f8f8f2">ExpandoMetaClass</span><span style="color: #f92672">.</span><span style="color: #a6e22e">enableGlobally</span><span style="color: #f92672">()</span>


<span style="color: #75715e">/**</span>
<span style="color: #75715e"> * Defines a unit and amount of measurement. Used for ingredients</span>
<span style="color: #75715e"> */</span>
<span style="color: #66d9ef">class</span> <span style="color: #a6e22e">Measure</span> <span style="color: #f92672">{</span>
   <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">amount</span>
   <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">unit</span>

   <span style="color: #f8f8f2">String</span> <span style="color: #a6e22e">toString</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
      <span style="color: #e6db74">&quot;${amount} ${unit}&quot;</span>
   <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>


<span style="color: #75715e">/*</span>
<span style="color: #75715e"> * Allow all number classes to be expressed as #.measurement</span>
<span style="color: #75715e"> */</span>
<span style="color: #f8f8f2">Number</span><span style="color: #f92672">.</span><span style="color: #a6e22e">metaClass</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getProperty</span> <span style="color: #f92672">=</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">measurement</span> <span style="color: #f92672">-&gt;</span>
   <span style="color: #66d9ef">new</span> <span style="color: #a6e22e">Measure</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">amount:</span> <span style="color: #f8f8f2">delegate</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">unit:</span> <span style="color: #f8f8f2">measurement</span><span style="color: #f92672">)</span>
<span style="color: #f92672">}</span>
</pre></div>


<p>Now with the measurement enhancement in place our DSL can now be written
like this.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">Recipe</span><span style="color: #f92672">.</span><span style="color: #a6e22e">create</span> <span style="color: #e6db74">&quot;Creamy Mac n&#39; Cheese&quot;</span><span style="color: #f92672">,</span> <span style="color: #f92672">{</span>
   <span style="color: #f8f8f2">addIngredient</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #a6e22e">box</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;Mac n&#39; Cheese&quot;</span>
   <span style="color: #f8f8f2">addIngredient</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #a6e22e">pound</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;Hamburger meat&quot;</span>
   <span style="color: #f8f8f2">addIngredient</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #a6e22e">can</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;Cream of Mushroom&quot;</span>

   <span style="color: #f8f8f2">addInstructions</span> <span style="color: #e6db74">&quot;Brown hamburger meat&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Bring mac n&#39; cheese to a boil&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Drain water from noodles&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Stir in cheese mixture&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Add cream of mushroom and meat&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Stir&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Eat&quot;</span>
<span style="color: #f92672">}</span>
</pre></div>
</p>

<p>Now, finally, let&rsquo;s create a couple of methods in our <strong>Recipe</strong> class
from part 2 that will display our culinary creations in a couple of
different ways. We will make code to show the recipe in a standard &ldquo;1,
2, 3&rdquo; step format, and also in XML. To make the DSL syntax a little more
fluent we will also create some enums that we will statically import to
be used as &ldquo;constants&rdquo; to describe how to display our recipe.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">import</span> <span style="color: #f8f8f2">static</span> <span style="color: #f8f8f2">ShowActions</span><span style="color: #f92672">.*</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">groovy.xml.MarkupBuilder</span>

<span style="color: #75715e">/*</span>
<span style="color: #75715e"> * These are the various actions that the &quot;show&quot; command can perform.</span>
<span style="color: #75715e"> */</span>
<span style="color: #66d9ef">enum</span> <span style="color: #f8f8f2">ShowActions</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">RecipeCard</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Ingredients</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Instructions</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">RecipeXml</span> <span style="color: #f92672">}</span>


<span style="color: #66d9ef">class</span> <span style="color: #a6e22e">Recipe</span> <span style="color: #f92672">{</span>
   <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">name</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;&quot;</span>
   <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">ingredients</span> <span style="color: #f92672">=</span> <span style="color: #f92672">[]</span>
   <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">instructions</span> <span style="color: #f92672">=</span> <span style="color: #f92672">[]</span>

   <span style="color: #66d9ef">static</span> <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">create</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">name</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Closure</span> <span style="color: #f8f8f2">c</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
      <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">clone</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">c</span><span style="color: #f92672">.</span><span style="color: #a6e22e">clone</span><span style="color: #f92672">()</span>
      <span style="color: #f8f8f2">clone</span><span style="color: #f92672">.</span><span style="color: #a6e22e">delegate</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Recipe</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">name:</span> <span style="color: #f8f8f2">name</span><span style="color: #f92672">)</span>
      <span style="color: #f8f8f2">clone</span><span style="color: #f92672">.</span><span style="color: #a6e22e">resolveStrategy</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Closure</span><span style="color: #f92672">.</span><span style="color: #a6e22e">DELEGATE_ONLY</span>    <span style="color: #75715e">// Resolve calls in this closure internally only</span>
      <span style="color: #f8f8f2">clone</span><span style="color: #f92672">()</span>
   <span style="color: #f92672">}</span>

   <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">addIngredient</span><span style="color: #f92672">(</span><span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">measurement</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">ingredient</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
      <span style="color: #f8f8f2">ingredients</span> <span style="color: #f92672">&lt;&lt;</span> <span style="color: #f92672">[</span> <span style="color: #f8f8f2">measure:</span> <span style="color: #f8f8f2">measurement</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">ingredient:</span> <span style="color: #f8f8f2">ingredient</span> <span style="color: #f92672">]</span>
   <span style="color: #f92672">}</span>

   <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">addInstructions</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">String</span><span style="color: #f92672">...</span> <span style="color: #f8f8f2">instruction</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
      <span style="color: #f8f8f2">instruction</span><span style="color: #f92672">.</span><span style="color: #a6e22e">each</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">instructions</span> <span style="color: #f92672">&lt;&lt;</span> <span style="color: #f8f8f2">it</span> <span style="color: #f92672">}</span>
   <span style="color: #f92672">}</span>

   <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">show</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">ShowActions</span> <span style="color: #f8f8f2">action</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
      <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">printIngredients</span> <span style="color: #f92672">=</span> <span style="color: #f92672">{</span>
      <span style="color: #f8f8f2">println</span> <span style="color: #e6db74">&quot;INGREDIENTS:&quot;</span>
      <span style="color: #f8f8f2">ingredients</span><span style="color: #f92672">.</span><span style="color: #a6e22e">eachWithIndex</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">item</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">index</span> <span style="color: #f92672">-&gt;</span> <span style="color: #f8f8f2">println</span> <span style="color: #e6db74">&quot;${index + 1}. ${item.measure} of  ${item.ingredient}&quot;</span> <span style="color: #f92672">}</span>
   <span style="color: #f92672">}</span>

      <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">printInstructions</span> <span style="color: #f92672">=</span> <span style="color: #f92672">{</span>
         <span style="color: #f8f8f2">println</span> <span style="color: #e6db74">&quot;</span>

<span style="color: #e6db74">DIRECTIONS:&quot;</span>
         <span style="color: #f8f8f2">instructions</span><span style="color: #f92672">.</span><span style="color: #a6e22e">eachWithIndex</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">item</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">index</span> <span style="color: #f92672">-&gt;</span> <span style="color: #f8f8f2">println</span> <span style="color: #e6db74">&quot;${index + 1}. ${item}&quot;</span> <span style="color: #f92672">}</span>
      <span style="color: #f92672">}</span>

      <span style="color: #66d9ef">switch</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">action</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
         <span style="color: #66d9ef">case</span> <span style="color: #f8f8f2">ShowActions</span><span style="color: #f92672">.</span><span style="color: #a6e22e">RecipeCard</span><span style="color: #f92672">:</span>
            <span style="color: #f8f8f2">printIngredients</span><span style="color: #f92672">()</span>
            <span style="color: #f8f8f2">printInstructions</span><span style="color: #f92672">()</span>
            <span style="color: #66d9ef">break</span>

         <span style="color: #66d9ef">case</span> <span style="color: #f8f8f2">ShowActions</span><span style="color: #f92672">.</span><span style="color: #a6e22e">Ingredients</span><span style="color: #f92672">:</span>
            <span style="color: #f8f8f2">printIngredients</span><span style="color: #f92672">()</span>
            <span style="color: #66d9ef">break</span>

         <span style="color: #66d9ef">case</span> <span style="color: #f8f8f2">ShowActions</span><span style="color: #f92672">.</span><span style="color: #a6e22e">Instructions</span><span style="color: #f92672">:</span>
            <span style="color: #f8f8f2">printInstructions</span><span style="color: #f92672">()</span>
            <span style="color: #66d9ef">break</span>

         <span style="color: #66d9ef">case</span> <span style="color: #f8f8f2">ShowActions</span><span style="color: #f92672">.</span><span style="color: #a6e22e">RecipeXml</span><span style="color: #f92672">:</span>
            <span style="color: #f8f8f2">println</span> <span style="color: #a6e22e">toXml</span><span style="color: #f92672">()</span>
            <span style="color: #66d9ef">break</span>
      <span style="color: #f92672">}</span>
   <span style="color: #f92672">}</span>

   <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">toXml</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
      <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">writer</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">StringWriter</span><span style="color: #f92672">()</span>
      <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">xml</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">MarkupBuilder</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">writer</span><span style="color: #f92672">)</span>

      <span style="color: #f8f8f2">xml</span><span style="color: #f92672">.</span><span style="color: #a6e22e">recipe</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">name:</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">name</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
         <span style="color: #f8f8f2">ingredients</span> <span style="color: #f92672">{</span>
            <span style="color: #f8f8f2">ingredients</span><span style="color: #f92672">.</span><span style="color: #a6e22e">each</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">ing</span> <span style="color: #f92672">-&gt;</span>
               <span style="color: #f8f8f2">ingredient</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">mkp</span><span style="color: #f92672">.</span><span style="color: #a6e22e">yieldUnescaped</span> <span style="color: #e6db74">&quot;&lt;![CDATA[${ing.measure} of ${ing.ingredient}]]&gt;&quot;</span> <span style="color: #f92672">}</span>
            <span style="color: #f92672">}</span>
         <span style="color: #f92672">}</span>
         <span style="color: #f8f8f2">instructions</span> <span style="color: #f92672">{</span>
            <span style="color: #f8f8f2">instructions</span><span style="color: #f92672">.</span><span style="color: #a6e22e">each</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">ins</span> <span style="color: #f92672">-&gt;</span>
               <span style="color: #f8f8f2">instruction</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">mkp</span><span style="color: #f92672">.</span><span style="color: #a6e22e">yieldUnescaped</span> <span style="color: #e6db74">&quot;&lt;![CDATA[${ins }]]&gt;&quot;</span> <span style="color: #f92672">}</span>
            <span style="color: #f92672">}</span>
         <span style="color: #f92672">}</span>
      <span style="color: #f92672">}</span>

      <span style="color: #f8f8f2">writer</span><span style="color: #f92672">.</span><span style="color: #a6e22e">toString</span><span style="color: #f92672">()</span>
   <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>
</p>

<p>The code above is the <strong>Recipe</strong> class with two new methods: <strong>show()</strong>
and <strong>toXml()</strong>. Here are a couple of sample uses with these new
methods.</p>

<h2 id="recipie-xml:c959beb457f298a00e5f0da4b57dffb2">Recipie XML</h2>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">Recipe</span><span style="color: #f92672">.</span><span style="color: #a6e22e">create</span> <span style="color: #e6db74">&quot;Creamy Mac n&#39; Cheese&quot;</span><span style="color: #f92672">,</span> <span style="color: #f92672">{</span>
   <span style="color: #f8f8f2">addIngredient</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #a6e22e">box</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;Mac n&#39; Cheese&quot;</span>
   <span style="color: #f8f8f2">addIngredient</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #a6e22e">pound</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;Hamburger meat&quot;</span>
   <span style="color: #f8f8f2">addIngredient</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #a6e22e">can</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;Cream of Mushroom&quot;</span>

   <span style="color: #f8f8f2">addInstructions</span> <span style="color: #e6db74">&quot;Brown hamburger meat&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Bring mac n&#39; cheese to a boil&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Drain water from noodles&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Stir in cheese mixture&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Add cream of mushroom and meat&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Stir&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Eat&quot;</span>

   <span style="color: #f8f8f2">show</span> <span style="color: #f8f8f2">RecipeXml</span>
<span style="color: #f92672">}</span>
</pre></div>
</p>

<h2 id="recipie-card:c959beb457f298a00e5f0da4b57dffb2">Recipie Card</h2>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">Recipe</span><span style="color: #f92672">.</span><span style="color: #a6e22e">create</span> <span style="color: #e6db74">&quot;Creamy Mac n&#39; Cheese&quot;</span><span style="color: #f92672">,</span> <span style="color: #f92672">{</span>
   <span style="color: #f8f8f2">addIngredient</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #a6e22e">box</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;Mac n&#39; Cheese&quot;</span>
   <span style="color: #f8f8f2">addIngredient</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #a6e22e">pound</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;Hamburger meat&quot;</span>
   <span style="color: #f8f8f2">addIngredient</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #a6e22e">can</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;Cream of Mushroom&quot;</span>

   <span style="color: #f8f8f2">addInstructions</span> <span style="color: #e6db74">&quot;Brown hamburger meat&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Bring mac n&#39; cheese to a boil&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Drain water from noodles&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Stir in cheese mixture&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Add cream of mushroom and meat&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Stir&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Eat&quot;</span>

   <span style="color: #f8f8f2">show</span> <span style="color: #f8f8f2">RecipeCard</span>
<span style="color: #f92672">}</span>
</pre></div>
</p>

<p>I hope this small introduction into DSL-world has been interesting. This
example barely scratches the surface of what can be done, and there is
certainly some pretty heavy reading out there on what can be done, and
how one can make DSLs. Here are some links to recommended reading.</p>

<ul>
<li><a href="http://docs.codehaus.org/display/GROOVY/Writing+Domain-Specific+Languages">Writing Domain-Specific Languages</a></li>
<li><a href="http://groovy.dzone.com/news/groovy-dsl-scratch-2-hours">A Groovy DSL from scratch in 2 hours</a></li>
<li><a href="http://blogs.citytechinc.com/sanderson/?p=92">A Text Adventure DSL in Groovy</a></li>
<li>Anything Martin Fowler!</li>
</ul>

<p>Here is the code in full:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">import</span> <span style="color: #f8f8f2">static</span> <span style="color: #f8f8f2">ShowActions</span><span style="color: #f92672">.*</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">groovy.xml.MarkupBuilder</span>

<span style="color: #75715e">/*</span>
<span style="color: #75715e"> * These are the various actions that the &quot;show&quot; command can perform.</span>
<span style="color: #75715e"> */</span>
<span style="color: #66d9ef">enum</span> <span style="color: #f8f8f2">ShowActions</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">RecipeCard</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Ingredients</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Instructions</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">RecipeXml</span> <span style="color: #f92672">}</span>


<span style="color: #75715e">/*</span>
<span style="color: #75715e"> * Ensure that changes to base classes through metaClass</span>
<span style="color: #75715e"> * expand downwards.</span>
<span style="color: #75715e"> */</span>
<span style="color: #f8f8f2">ExpandoMetaClass</span><span style="color: #f92672">.</span><span style="color: #a6e22e">enableGlobally</span><span style="color: #f92672">()</span>


<span style="color: #75715e">/**</span>
<span style="color: #75715e"> * Defines a unit and amount of measurement. Used for ingredients</span>
<span style="color: #75715e"> */</span>
<span style="color: #66d9ef">class</span> <span style="color: #a6e22e">Measure</span> <span style="color: #f92672">{</span>
   <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">amount</span>
   <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">unit</span>

   <span style="color: #f8f8f2">String</span> <span style="color: #a6e22e">toString</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
      <span style="color: #e6db74">&quot;${amount} ${unit}&quot;</span>
   <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>


<span style="color: #75715e">/**</span>
<span style="color: #75715e"> * Defines the recipe &quot;language&quot;, it&#39;s data, and transformations.</span>
<span style="color: #75715e"> */</span>
<span style="color: #66d9ef">class</span> <span style="color: #a6e22e">Recipe</span> <span style="color: #f92672">{</span>
   <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">name</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;&quot;</span>
   <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">ingredients</span> <span style="color: #f92672">=</span> <span style="color: #f92672">[]</span>
   <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">instructions</span> <span style="color: #f92672">=</span> <span style="color: #f92672">[]</span>

   <span style="color: #66d9ef">static</span> <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">create</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">name</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Closure</span> <span style="color: #f8f8f2">c</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
      <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">clone</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">c</span><span style="color: #f92672">.</span><span style="color: #a6e22e">clone</span><span style="color: #f92672">()</span>
      <span style="color: #f8f8f2">clone</span><span style="color: #f92672">.</span><span style="color: #a6e22e">delegate</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Recipe</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">name:</span> <span style="color: #f8f8f2">name</span><span style="color: #f92672">)</span>
      <span style="color: #f8f8f2">clone</span><span style="color: #f92672">.</span><span style="color: #a6e22e">resolveStrategy</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Closure</span><span style="color: #f92672">.</span><span style="color: #a6e22e">DELEGATE_ONLY</span>    <span style="color: #75715e">// Resolve calls in this closure internally only</span>
      <span style="color: #f8f8f2">clone</span><span style="color: #f92672">()</span>
   <span style="color: #f92672">}</span>

   <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">addIngredient</span><span style="color: #f92672">(</span><span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">measurement</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">ingredient</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
      <span style="color: #f8f8f2">ingredients</span> <span style="color: #f92672">&lt;&lt;</span> <span style="color: #f92672">[</span> <span style="color: #f8f8f2">measure:</span> <span style="color: #f8f8f2">measurement</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">ingredient:</span> <span style="color: #f8f8f2">ingredient</span> <span style="color: #f92672">]</span>
   <span style="color: #f92672">}</span>

   <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">addInstructions</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">String</span><span style="color: #f92672">...</span> <span style="color: #f8f8f2">instruction</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
      <span style="color: #f8f8f2">instruction</span><span style="color: #f92672">.</span><span style="color: #a6e22e">each</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">instructions</span> <span style="color: #f92672">&lt;&lt;</span> <span style="color: #f8f8f2">it</span> <span style="color: #f92672">}</span>
   <span style="color: #f92672">}</span>

   <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">show</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">ShowActions</span> <span style="color: #f8f8f2">action</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
      <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">printIngredients</span> <span style="color: #f92672">=</span> <span style="color: #f92672">{</span>
      <span style="color: #f8f8f2">println</span> <span style="color: #e6db74">&quot;INGREDIENTS:&quot;</span>
      <span style="color: #f8f8f2">ingredients</span><span style="color: #f92672">.</span><span style="color: #a6e22e">eachWithIndex</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">item</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">index</span> <span style="color: #f92672">-&gt;</span> <span style="color: #f8f8f2">println</span> <span style="color: #e6db74">&quot;${index + 1}. ${item.measure} of  ${item.ingredient}&quot;</span> <span style="color: #f92672">}</span>
   <span style="color: #f92672">}</span>

      <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">printInstructions</span> <span style="color: #f92672">=</span> <span style="color: #f92672">{</span>
         <span style="color: #f8f8f2">println</span> <span style="color: #e6db74">&quot;</span>

<span style="color: #e6db74">DIRECTIONS:&quot;</span>
         <span style="color: #f8f8f2">instructions</span><span style="color: #f92672">.</span><span style="color: #a6e22e">eachWithIndex</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">item</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">index</span> <span style="color: #f92672">-&gt;</span> <span style="color: #f8f8f2">println</span> <span style="color: #e6db74">&quot;${index + 1}. ${item}&quot;</span> <span style="color: #f92672">}</span>
      <span style="color: #f92672">}</span>

      <span style="color: #66d9ef">switch</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">action</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
         <span style="color: #66d9ef">case</span> <span style="color: #f8f8f2">ShowActions</span><span style="color: #f92672">.</span><span style="color: #a6e22e">RecipeCard</span><span style="color: #f92672">:</span>
            <span style="color: #f8f8f2">printIngredients</span><span style="color: #f92672">()</span>
            <span style="color: #f8f8f2">printInstructions</span><span style="color: #f92672">()</span>
            <span style="color: #66d9ef">break</span>

         <span style="color: #66d9ef">case</span> <span style="color: #f8f8f2">ShowActions</span><span style="color: #f92672">.</span><span style="color: #a6e22e">Ingredients</span><span style="color: #f92672">:</span>
            <span style="color: #f8f8f2">printIngredients</span><span style="color: #f92672">()</span>
            <span style="color: #66d9ef">break</span>

         <span style="color: #66d9ef">case</span> <span style="color: #f8f8f2">ShowActions</span><span style="color: #f92672">.</span><span style="color: #a6e22e">Instructions</span><span style="color: #f92672">:</span>
            <span style="color: #f8f8f2">printInstructions</span><span style="color: #f92672">()</span>
            <span style="color: #66d9ef">break</span>

         <span style="color: #66d9ef">case</span> <span style="color: #f8f8f2">ShowActions</span><span style="color: #f92672">.</span><span style="color: #a6e22e">RecipeXml</span><span style="color: #f92672">:</span>
            <span style="color: #f8f8f2">println</span> <span style="color: #a6e22e">toXml</span><span style="color: #f92672">()</span>
            <span style="color: #66d9ef">break</span>
      <span style="color: #f92672">}</span>
   <span style="color: #f92672">}</span>

   <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">toXml</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
      <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">writer</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">StringWriter</span><span style="color: #f92672">()</span>
      <span style="color: #66d9ef">def</span> <span style="color: #f8f8f2">xml</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">MarkupBuilder</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">writer</span><span style="color: #f92672">)</span>

      <span style="color: #f8f8f2">xml</span><span style="color: #f92672">.</span><span style="color: #a6e22e">recipe</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">name:</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">name</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
         <span style="color: #f8f8f2">ingredients</span> <span style="color: #f92672">{</span>
            <span style="color: #f8f8f2">ingredients</span><span style="color: #f92672">.</span><span style="color: #a6e22e">each</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">ing</span> <span style="color: #f92672">-&gt;</span>
               <span style="color: #f8f8f2">ingredient</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">mkp</span><span style="color: #f92672">.</span><span style="color: #a6e22e">yieldUnescaped</span> <span style="color: #e6db74">&quot;&lt;![CDATA[${ing.measure} of ${ing.ingredient}]]&gt;&quot;</span> <span style="color: #f92672">}</span>
            <span style="color: #f92672">}</span>
         <span style="color: #f92672">}</span>
         <span style="color: #f8f8f2">instructions</span> <span style="color: #f92672">{</span>
            <span style="color: #f8f8f2">instructions</span><span style="color: #f92672">.</span><span style="color: #a6e22e">each</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">ins</span> <span style="color: #f92672">-&gt;</span>
               <span style="color: #f8f8f2">instruction</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">mkp</span><span style="color: #f92672">.</span><span style="color: #a6e22e">yieldUnescaped</span> <span style="color: #e6db74">&quot;&lt;![CDATA[${ins }]]&gt;&quot;</span> <span style="color: #f92672">}</span>
            <span style="color: #f92672">}</span>
         <span style="color: #f92672">}</span>
      <span style="color: #f92672">}</span>

      <span style="color: #f8f8f2">writer</span><span style="color: #f92672">.</span><span style="color: #a6e22e">toString</span><span style="color: #f92672">()</span>
   <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>

<span style="color: #75715e">/*</span>
<span style="color: #75715e"> * Allow all number classes to be expressed as #.measurement</span>
<span style="color: #75715e"> */</span>
<span style="color: #f8f8f2">Number</span><span style="color: #f92672">.</span><span style="color: #a6e22e">metaClass</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getProperty</span> <span style="color: #f92672">=</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">measurement</span> <span style="color: #f92672">-&gt;</span>
   <span style="color: #66d9ef">new</span> <span style="color: #a6e22e">Measure</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">amount:</span> <span style="color: #f8f8f2">delegate</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">unit:</span> <span style="color: #f8f8f2">measurement</span><span style="color: #f92672">)</span>
<span style="color: #f92672">}</span>


<span style="color: #75715e">/*</span>
<span style="color: #75715e"> * Actually try USING our little DSL.</span>
<span style="color: #75715e"> */</span>
<span style="color: #f8f8f2">Recipe</span><span style="color: #f92672">.</span><span style="color: #a6e22e">create</span> <span style="color: #e6db74">&quot;Creamy Mac n&#39; Cheese&quot;</span><span style="color: #f92672">,</span> <span style="color: #f92672">{</span>
   <span style="color: #f8f8f2">addIngredient</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #a6e22e">box</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;Mac n&#39; Cheese&quot;</span>
   <span style="color: #f8f8f2">addIngredient</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #a6e22e">pound</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;Hamburger meat&quot;</span>
   <span style="color: #f8f8f2">addIngredient</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #a6e22e">can</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;Cream of Mushroom&quot;</span>

   <span style="color: #f8f8f2">addInstructions</span> <span style="color: #e6db74">&quot;Brown hamburger meat&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Bring mac n&#39; cheese to a boil&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Drain water from noodles&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Stir in cheese mixture&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Add cream of mushroom and meat&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Stir&quot;</span><span style="color: #f92672">,</span>
      <span style="color: #e6db74">&quot;Eat&quot;</span>

   <span style="color: #f8f8f2">show</span> <span style="color: #f8f8f2">RecipeXml</span>
<span style="color: #f92672">}</span>
</pre></div>
</p>

<p>Happy coding!</p>

            <ul class="share-buttons">
    <li></li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fadampresley.com%2fpost%2fintro-to-dsls-in-groovy-part-3%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=Intro%20to%20DSLs%20in%20Groovy%2c%20Part%203&amp;url=http%3a%2f%2fadampresley.com%2fpost%2fintro-to-dsls-in-groovy-part-3%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-gplus" href="https://plus.google.com/share?url=http%3a%2f%2fadampresley.com%2fpost%2fintro-to-dsls-in-groovy-part-3%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fadampresley.com%2fpost%2fintro-to-dsls-in-groovy-part-3%2f&title=Intro%20to%20DSLs%20in%20Groovy%2c%20Part%203" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title=""></a>
    </li>
</ul>

        </article>
        <div class="comments">
            <h3></h3>
            <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'adampresleyblog';
    var disqus_identifier = 'http:\/\/adampresley.com\/post\/intro-to-dsls-in-groovy-part-3\/';
    var disqus_title = 'Intro to DSLs in Groovy, Part 3';
    var disqus_url = 'http:\/\/adampresley.com\/post\/intro-to-dsls-in-groovy-part-3\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    </main>
    <aside class="author">
  <img class="profile-image" src="http://adampresley.com/assets/adampresley/images/adam-bowtie.png" alt="Adam Presley" />
  <p class="name"> 
  <strong>Adam Presley</strong></p>
  <p class="address">Texas, USA</p>
  <p class="link"></p>
  <ul class="social">
    
<li><a href="//twitter.com/adampresley" class="icon-twitter" target="_blank" title="Twitter"></a></li>













<li><a href="//github.com/adampresley" class="icon-github" target="_blank" title="Github"></a></li>




<li><a href="http://adampresley.com/post/index.xml" class="icon-rss" target="_blank" title="RSS"></a></li>

  </ul>
  <br><br>
</aside>

</div>

<footer class="main-footer">
  <div class="container clearfix">
        <a class="icon-rss" href="http://adampresley.com/post/index.xml" title="RSS"></a>
        <p>&copy; 2016 &middot; Adam Presley. All Rights Reserved. Powered by <a href="http://gohugo.io">Hugo</a>.</p>
  </div>
</footer>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>window.jQuery || document.write('<script src="http:\/\/adampresley.com\/js/vendor/jquery-1.11.0.min.js"><\/script>')</script>
<script src="http://adampresley.com/js/plugins.js"></script>

<!-- Google Analytics -->
<script>
  var _gaq=[['_setAccount','UA-44927419-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>

