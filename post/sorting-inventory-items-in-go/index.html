<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Adam.Blog()</title>
        <meta name="author">
        <meta name="description" content="I&#39;m bringin&#39; nerdy back">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="generator" content="Hugo 0.16-DEV" />
          <link href="http://adampresley.com/post/index.xml" rel="alternate" type="application/rss+xml" title="Adam.Blog()" />
          <link href="http://adampresley.com/post/index.xml" rel="feed" type="application/rss+xml" title="Adam.Blog()" />
        <link href='//fonts.googleapis.com/css?family=Roboto:400,300,700|Noto+Serif:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="http://adampresley.com/css/styles.css">
        <link rel="icon" href="http://adampresley.com/favicon.ico">
        <link rel="apple-touch-icon" href="http://adampresley.com/apple-touch-icon.png" />
        <link rel="stylesheet" href="http://adampresley.com/css/highlightjs/monokai.css">
        <script src="http://adampresley.com/js/vendor/modernizr-2.8.0.min.js"></script>
        <style>
        .site-header h2 .logo {
        background: url(http://adampresley.com/assets/images/code-background-screenshot.png) no-repeat 0 0;
        }
        @media (min--moz-device-pixel-ratio: 1.3), (-o-min-device-pixel-ratio: 2.6 / 2), (-webkit-min-device-pixel-ratio: 1.3), (min-device-pixel-ratio: 1.3), (min-resolution: 1.3dppx) {
          .site-header h2 .logo {
            background-image: url(http://adampresley.com/assets/images/code-background-screenshot.png);
        }}
       .site-header {
         background: #2a373d url(http://adampresley.com/assets/images/code-background-screenshot.png) no-repeat center center;
         z-index: -1;
        }
        </style>
    </head>
    <body>
        
        <header class="site-header">
          <div class="transparent-layer">
              <h2>Adam.Blog()</h2>
          </div>
        </header>


<div class="container clearfix">
    <main role="main" class="content">
        <article class="post">
            <a class="btn home" href="http://adampresley.com/" title="">&laquo; </a>
            
<h1><a href="http://adampresley.com/post/sorting-inventory-items-in-go/" title="Sorting Inventory Items in Go">Sorting Inventory Items in Go</a></h1>

<footer class="post-info"> <span class="post-meta"><time datetime="2015.09.06">2015.09.06</time>

    &middot; 
        
        <a href="http://adampresley.com/tags/development">development</a>, 
        
        <a href="http://adampresley.com/tags/golang">golang</a>
        
    

</span>
</footer>

            

<p><img src="/assets/adampresley/images/posts/files-and-clips.png" alt="Sorted Paperwork" /></p>

<p>Sorting is a fundamental, boring, but useful topic. When developing applications in the business world many times the challenges of sorting are only as complex as an <strong>ORDER BY</strong> clause in a SQL statement. Not all data comes from relational databases, however, and knowing how to perform a basic sort on complex data can be a handy item in the toolbelt. In this post I&rsquo;ll demonstrate how to sort a slice of inventory items. We will even write unit tests so that we enforce good habits right from the start. Let&rsquo;s get started.</p>

<!-- excerpt -->

<p><img src="/assets/adampresley/images/posts/go-sorting-example-diagram.png" alt="Go Sorting Example Diagram" /></p>

<p>The above model diagram illustrates what we&rsquo;ll build in this blog post. Essentially we want to represent an <em>Inventory</em> item. Each <em>Inventory</em> item is a <em>Product</em> with a <em>ProductSize</em> and <em>Price</em>. Then, when given an array (slice) of inventory items we want to be able to sort them. The criteria for sorting is as follows.</p>

<ol>
<li>Sort first by unique name</li>
<li>If two or more product names are the same then sort by size</li>
</ol>

<p>To follow along with this example you can clone the <a href="https://github.com/adampresley/golang-sorting-example">repository at Github</a>.</p>

<h2 id="product-size:99cc3f74ca995387d7a4ee65a7fa4685">Product Size</h2>

<p>To start this off let&rsquo;s model the easiest item that has no additional dependencies. A <em>Product Size</em> represents the size of a product item. This could be shirt sizes, or the product could have no sizes. With this in mind let&rsquo;s work on a sample set of sizes as follows.</p>

<ol>
<li>Not applicable</li>
<li>Extra Small</li>
<li>Small</li>
<li>Medium</li>
<li>Large</li>
<li>Extra Large</li>
<li>2-Extra Large</li>
</ol>

<p>Now we need to define a structure that will best represent the ability to track sizes.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">package</span> <span style="color: #a6e22e">product</span>

<span style="color: #66d9ef">type</span> <span style="color: #a6e22e">ProductSize</span> <span style="color: #66d9ef">struct</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #a6e22e">Abbreviation</span> <span style="color: #66d9ef">string</span>
  <span style="color: #a6e22e">Size</span>         <span style="color: #66d9ef">string</span>
  <span style="color: #a6e22e">SortOrder</span>    <span style="color: #66d9ef">int</span>
<span style="color: #f8f8f2">}</span>
</pre></div>


<p>With this structure we are representing a product size as an abbreviation and a descriptive text. With the <strong>SortOrder</strong> property we are also defining a way to sort the size. This can come in handy for displaying sizes, as well as in sorting. While we are here let&rsquo;s define a set of sizes to make our life easier.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">NA</span> <span style="color: #a6e22e">ProductSize</span> <span style="color: #f8f8f2">=</span> <span style="color: #a6e22e">ProductSize</span><span style="color: #f8f8f2">{</span><span style="color: #e6db74">&quot;NA&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;Not applicable&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">}</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">XS</span> <span style="color: #a6e22e">ProductSize</span> <span style="color: #f8f8f2">=</span> <span style="color: #a6e22e">ProductSize</span><span style="color: #f8f8f2">{</span><span style="color: #e6db74">&quot;XS&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;Extra Small&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2">}</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">S</span> <span style="color: #a6e22e">ProductSize</span> <span style="color: #f8f8f2">=</span> <span style="color: #a6e22e">ProductSize</span><span style="color: #f8f8f2">{</span><span style="color: #e6db74">&quot;S&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;Small&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">3</span><span style="color: #f8f8f2">}</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">M</span> <span style="color: #a6e22e">ProductSize</span> <span style="color: #f8f8f2">=</span> <span style="color: #a6e22e">ProductSize</span><span style="color: #f8f8f2">{</span><span style="color: #e6db74">&quot;M&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;Medium&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">4</span><span style="color: #f8f8f2">}</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">L</span> <span style="color: #a6e22e">ProductSize</span> <span style="color: #f8f8f2">=</span> <span style="color: #a6e22e">ProductSize</span><span style="color: #f8f8f2">{</span><span style="color: #e6db74">&quot;L&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;Large&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">5</span><span style="color: #f8f8f2">}</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">XL</span> <span style="color: #a6e22e">ProductSize</span> <span style="color: #f8f8f2">=</span> <span style="color: #a6e22e">ProductSize</span><span style="color: #f8f8f2">{</span><span style="color: #e6db74">&quot;XL&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;Extra Large&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">6</span><span style="color: #f8f8f2">}</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">XXL</span> <span style="color: #a6e22e">ProductSize</span> <span style="color: #f8f8f2">=</span> <span style="color: #a6e22e">ProductSize</span><span style="color: #f8f8f2">{</span><span style="color: #e6db74">&quot;XXL&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;2-Extra Large&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">7</span><span style="color: #f8f8f2">}</span>
</pre></div>


<h2 id="product:99cc3f74ca995387d7a4ee65a7fa4685">Product</h2>

<p>Now that we have a way to define the size of a product, let&rsquo;s define a <em>Product</em>. For this example I&rsquo;ll keep this simple. A product is defined by a name and a size. In our example system a <em>Product</em> is a thing that is sold, and it only describes the thing.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">package</span> <span style="color: #a6e22e">product</span>

<span style="color: #66d9ef">type</span> <span style="color: #a6e22e">Product</span> <span style="color: #66d9ef">struct</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #a6e22e">Name</span> <span style="color: #66d9ef">string</span>
  <span style="color: #a6e22e">Size</span> <span style="color: #a6e22e">ProductSize</span>
<span style="color: #f8f8f2">}</span>
</pre></div>


<h2 id="inventory:99cc3f74ca995387d7a4ee65a7fa4685">Inventory</h2>

<p>If a <em>Product</em> represents the thing we are selling, an <em>Inventory</em> item represents how much of a product item you have to sell, and how much it costs. We could also represent information about discounts and warehouse locations, but this example we are only really concerned with the <em>Product</em> and <em>Price</em>.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">package</span> <span style="color: #a6e22e">inventory</span>

<span style="color: #f92672">import</span> <span style="color: #f8f8f2">(</span>
  <span style="color: #e6db74">&quot;fmt&quot;</span>

  <span style="color: #e6db74">&quot;github.com/adampresley/golang-sorting-example/model/product&quot;</span>
<span style="color: #f8f8f2">)</span>

<span style="color: #66d9ef">type</span> <span style="color: #a6e22e">Inventory</span> <span style="color: #66d9ef">struct</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Product</span>
  <span style="color: #a6e22e">Price</span> <span style="color: #66d9ef">float64</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">func</span> <span style="color: #f8f8f2">(</span><span style="color: #a6e22e">inventory</span> <span style="color: #a6e22e">Inventory</span><span style="color: #f8f8f2">)</span> <span style="color: #a6e22e">String</span><span style="color: #f8f8f2">()</span> <span style="color: #66d9ef">string</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">return</span> <span style="color: #a6e22e">fmt</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Sprintf</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;%s - %.2f&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">inventory</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Name</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">inventory</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Price</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">}</span>
</pre></div>


<p>In the above code we are defining a structure for an <em>Inventory</em> item. Notice how we use Go&rsquo;s composability features by referencing the <em>Product</em> structure. This essentially embeds the product fields into a property named <strong>Product</strong>, but with some added conviences. We also implement the <strong>String()</strong> method to satisfy the <a href="https://golang.org/pkg/fmt/#Stringer">Stringer</a> interface.</p>

<h2 id="sorting:99cc3f74ca995387d7a4ee65a7fa4685">Sorting</h2>

<p>Sorting in Go is done via the <a href="https://golang.org/pkg/sort/">sort package</a>. The documentation reveals that to perform a sort of complex object you use the <strong>sort()</strong> method on a type that satisfies the <a href="https://golang.org/pkg/sort/#Interface">sort.Interface</a> interface. To do this let&rsquo;s create a type that represents a comparator, which will be a collection of <em>Inventory</em> items.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">package</span> <span style="color: #a6e22e">inventory</span>

<span style="color: #66d9ef">type</span> <span style="color: #a6e22e">InventoryComparator</span> <span style="color: #f8f8f2">[]</span><span style="color: #a6e22e">Inventory</span>
</pre></div>
</p>

<p>This by itself is not enough. As the documentation points out we need to implement the <strong>sort.Interface</strong> interface (I know that reads poorly, and I&rsquo;m sorry). This means our comparator type needs to implement three functions: <strong>Len()</strong>, <strong>Swap()</strong>, and <strong>Less()</strong>. The <strong>Len()</strong> function should return the number of items in the collection. The <strong>Swap()</strong> function should take two integer indexes and swap the two items found at those indexes. And finally the <strong>Less()</strong> function should return true if the item at the first index is less than the item at the second index. If you recall above our first criteria is to sort by the product name. So let&rsquo;s start with that.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">func</span> <span style="color: #f8f8f2">(</span><span style="color: #a6e22e">items</span> <span style="color: #a6e22e">InventoryComparator</span><span style="color: #f8f8f2">)</span> <span style="color: #a6e22e">Len</span><span style="color: #f8f8f2">()</span> <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">len(</span><span style="color: #a6e22e">items</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">func</span> <span style="color: #f8f8f2">(</span><span style="color: #a6e22e">items</span> <span style="color: #a6e22e">InventoryComparator</span><span style="color: #f8f8f2">)</span> <span style="color: #a6e22e">Swap</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">i</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">j</span> <span style="color: #66d9ef">int</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #a6e22e">items</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">i</span><span style="color: #f8f8f2">],</span> <span style="color: #a6e22e">items</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">j</span><span style="color: #f8f8f2">]</span> <span style="color: #f8f8f2">=</span> <span style="color: #a6e22e">items</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">j</span><span style="color: #f8f8f2">],</span> <span style="color: #a6e22e">items</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">i</span><span style="color: #f8f8f2">]</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">func</span> <span style="color: #f8f8f2">(</span><span style="color: #a6e22e">items</span> <span style="color: #a6e22e">InventoryComparator</span><span style="color: #f8f8f2">)</span> <span style="color: #a6e22e">Less</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">i</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">j</span> <span style="color: #66d9ef">int</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">bool</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">return</span> <span style="color: #a6e22e">items</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">i</span><span style="color: #f8f8f2">].</span><span style="color: #a6e22e">Name</span> <span style="color: #f8f8f2">&lt;</span> <span style="color: #a6e22e">items</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">j</span><span style="color: #f8f8f2">].</span><span style="color: #a6e22e">Name</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<h2 id="testing:99cc3f74ca995387d7a4ee65a7fa4685">Testing</h2>

<p>Now let&rsquo;s switch gears a bit. As a matter of good habit, and to ensure our code is working, let&rsquo;s write some tests. For this blog entry I will use <a href="http://goconvey.co/">GoConvey</a>, though you can certainly use the vanilla unit testing framework that comes with Go. Convey just adds a bit of color, and I like the BDD style of writing tests. Let&rsquo;s write a test that ensures that sorting orders inventory items by name.</p>

<h3 id="first-test:99cc3f74ca995387d7a4ee65a7fa4685">First Test</h3>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">package</span> <span style="color: #a6e22e">inventory</span>

<span style="color: #f92672">import</span> <span style="color: #f8f8f2">(</span>
  <span style="color: #e6db74">&quot;sort&quot;</span>
  <span style="color: #e6db74">&quot;testing&quot;</span>

  <span style="color: #e6db74">&quot;github.com/adampresley/golang-sorting-example/model/product&quot;</span>

  <span style="color: #f8f8f2">.</span> <span style="color: #e6db74">&quot;github.com/smartystreets/goconvey/convey&quot;</span>
<span style="color: #f8f8f2">)</span>

<span style="color: #66d9ef">func</span> <span style="color: #a6e22e">TestInventoryComparator</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">t</span> <span style="color: #f92672">*</span><span style="color: #a6e22e">testing</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">T</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #75715e">/*</span>
<span style="color: #75715e">   * Let&#39;s test the comparator</span>
<span style="color: #75715e">   */</span>
  <span style="color: #a6e22e">Convey</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;Inventory comparator&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">t</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">func</span><span style="color: #f8f8f2">()</span> <span style="color: #f8f8f2">{</span>

    <span style="color: #75715e">/*</span>
<span style="color: #75715e">     * Ensure that the comparator sorts by name</span>
<span style="color: #75715e">     */</span>
    <span style="color: #a6e22e">Convey</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;Sorts by name&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">func</span><span style="color: #f8f8f2">()</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #75715e">/*</span>
<span style="color: #75715e">       * This is our initial inventory array. Notice the names are out of order.</span>
<span style="color: #75715e">       * When the sort is run this array gets modified directly.</span>
<span style="color: #75715e">       */</span>
      <span style="color: #a6e22e">actual</span> <span style="color: #f92672">:=</span> <span style="color: #f8f8f2">[]</span><span style="color: #a6e22e">Inventory</span><span style="color: #f8f8f2">{</span>
        <span style="color: #f8f8f2">{</span>
          <span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">{</span><span style="color: #a6e22e">Name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Widget 2&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">Size</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">NA</span><span style="color: #f8f8f2">},</span>
          <span style="color: #a6e22e">Price</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">59.75</span><span style="color: #f8f8f2">,</span>
        <span style="color: #f8f8f2">},</span>
        <span style="color: #f8f8f2">{</span>
          <span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">{</span><span style="color: #a6e22e">Name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Widget 1&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">Size</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">NA</span><span style="color: #f8f8f2">},</span>
          <span style="color: #a6e22e">Price</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">199.99</span><span style="color: #f8f8f2">,</span>
        <span style="color: #f8f8f2">},</span>
        <span style="color: #f8f8f2">{</span>
          <span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">{</span><span style="color: #a6e22e">Name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Dr. Who T-Shirt&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">Size</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">L</span><span style="color: #f8f8f2">},</span>
          <span style="color: #a6e22e">Price</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">29.95</span><span style="color: #f8f8f2">,</span>
        <span style="color: #f8f8f2">},</span>
      <span style="color: #f8f8f2">}</span>

      <span style="color: #75715e">/*</span>
<span style="color: #75715e">       * Here is what we expect the result to be.</span>
<span style="color: #75715e">       */</span>
      <span style="color: #a6e22e">expected</span> <span style="color: #f92672">:=</span> <span style="color: #f8f8f2">[]</span><span style="color: #a6e22e">Inventory</span><span style="color: #f8f8f2">{</span>
        <span style="color: #f8f8f2">{</span>
          <span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">{</span><span style="color: #a6e22e">Name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Dr. Who T-Shirt&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">Size</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">L</span><span style="color: #f8f8f2">},</span>
          <span style="color: #a6e22e">Price</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">29.95</span><span style="color: #f8f8f2">,</span>
        <span style="color: #f8f8f2">},</span>
        <span style="color: #f8f8f2">{</span>
          <span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">{</span><span style="color: #a6e22e">Name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Widget 1&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">Size</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">NA</span><span style="color: #f8f8f2">},</span>
          <span style="color: #a6e22e">Price</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">199.99</span><span style="color: #f8f8f2">,</span>
        <span style="color: #f8f8f2">},</span>
        <span style="color: #f8f8f2">{</span>
          <span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">{</span><span style="color: #a6e22e">Name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Widget 2&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">Size</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">NA</span><span style="color: #f8f8f2">},</span>
          <span style="color: #a6e22e">Price</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">59.75</span><span style="color: #f8f8f2">,</span>
        <span style="color: #f8f8f2">},</span>
      <span style="color: #f8f8f2">}</span>

      <span style="color: #75715e">/*</span>
<span style="color: #75715e">       * Sort, then assert that we expect the two arrays to be the same. In</span>
<span style="color: #75715e">       * GoConvey ShouldResemble does a deep compare.</span>
<span style="color: #75715e">       */</span>
      <span style="color: #a6e22e">sort</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Sort</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">InventoryComparator</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">actual</span><span style="color: #f8f8f2">))</span>
      <span style="color: #a6e22e">So</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">actual</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">ShouldResemble</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">expected</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">})</span>
  <span style="color: #f8f8f2">})</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>To start things off we first want to <em>convey</em> the idea that we are testing the comparator feature. All comparator tests will then be executed under this function. Our first test attempts to prove that calling sort, using our comparator, will sort the array of inventory items by name. The comparator with the sort method looks like this: <code>sort.Sort(InventoryComparator(myUnsortedArray))</code>.</p>

<p>To do this we start off by creating a slice of <em>Inventory</em> items, each with a <em>Product</em> and a <em>Price</em>. Notice each name is unique and out of order. We are naming this slice <strong>actual</strong> because this is what we will call sort against, and it is the actual result we are testing. Then we build another slice of <em>Inventory</em> items called <strong>expected</strong>. This slice has the items in order as we expect them to turn out. The final result is to call sort using our comparator type against <strong>actual</strong>, and we expect that the results should resemble each other. In GoConvey terminology the <em>ShouldResemble</em> operator states that it will do a deep comparision of two slices, and although each slice is fundamentally different due to memory locations and allocations, the data should be the same.</p>

<p>Go ahead and run the test, and watch it work! Groovy!</p>

<h3 id="second-test:99cc3f74ca995387d7a4ee65a7fa4685">Second Test</h3>

<p>Now let&rsquo;s implement a test to start working on our second sort criteria. When there are two or more inventory items have the same name, but different sizes, we want the sort comparator to order by size. To do this we can use the <strong>SortOrder</strong> column in the <em>ProductSize</em> structure to compare two sizes. First, however, let&rsquo;s write the test.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>    <span style="color: #a6e22e">Convey</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;Sorts by size when the names are the same&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">func</span><span style="color: #f8f8f2">()</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #a6e22e">actual</span> <span style="color: #f92672">:=</span> <span style="color: #f8f8f2">[]</span><span style="color: #a6e22e">Inventory</span><span style="color: #f8f8f2">{</span>
        <span style="color: #f8f8f2">{</span>
          <span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">{</span><span style="color: #a6e22e">Name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Widget 1&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">Size</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">NA</span><span style="color: #f8f8f2">},</span>
          <span style="color: #a6e22e">Price</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">59.75</span><span style="color: #f8f8f2">,</span>
        <span style="color: #f8f8f2">},</span>
        <span style="color: #f8f8f2">{</span>
          <span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">{</span><span style="color: #a6e22e">Name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Dr. Who T-Shirt&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">Size</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">L</span><span style="color: #f8f8f2">},</span>
          <span style="color: #a6e22e">Price</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">29.95</span><span style="color: #f8f8f2">,</span>
        <span style="color: #f8f8f2">},</span>
        <span style="color: #f8f8f2">{</span>
          <span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">{</span><span style="color: #a6e22e">Name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Dr. Who T-Shirt&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">Size</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">S</span><span style="color: #f8f8f2">},</span>
          <span style="color: #a6e22e">Price</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">29.95</span><span style="color: #f8f8f2">,</span>
        <span style="color: #f8f8f2">},</span>
        <span style="color: #f8f8f2">{</span>
          <span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">{</span><span style="color: #a6e22e">Name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Dr. Who T-Shirt&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">Size</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">M</span><span style="color: #f8f8f2">},</span>
          <span style="color: #a6e22e">Price</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">29.95</span><span style="color: #f8f8f2">,</span>
        <span style="color: #f8f8f2">},</span>
      <span style="color: #f8f8f2">}</span>

      <span style="color: #a6e22e">expected</span> <span style="color: #f92672">:=</span> <span style="color: #f8f8f2">[]</span><span style="color: #a6e22e">Inventory</span><span style="color: #f8f8f2">{</span>
        <span style="color: #f8f8f2">{</span>
          <span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">{</span><span style="color: #a6e22e">Name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Dr. Who T-Shirt&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">Size</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">S</span><span style="color: #f8f8f2">},</span>
          <span style="color: #a6e22e">Price</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">29.95</span><span style="color: #f8f8f2">,</span>
        <span style="color: #f8f8f2">},</span>
        <span style="color: #f8f8f2">{</span>
          <span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">{</span><span style="color: #a6e22e">Name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Dr. Who T-Shirt&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">Size</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">M</span><span style="color: #f8f8f2">},</span>
          <span style="color: #a6e22e">Price</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">29.95</span><span style="color: #f8f8f2">,</span>
        <span style="color: #f8f8f2">},</span>
        <span style="color: #f8f8f2">{</span>
          <span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">{</span><span style="color: #a6e22e">Name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Dr. Who T-Shirt&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">Size</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">L</span><span style="color: #f8f8f2">},</span>
          <span style="color: #a6e22e">Price</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">29.95</span><span style="color: #f8f8f2">,</span>
        <span style="color: #f8f8f2">},</span>
        <span style="color: #f8f8f2">{</span>
          <span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Product</span><span style="color: #f8f8f2">{</span><span style="color: #a6e22e">Name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Widget 1&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">Size</span><span style="color: #f8f8f2">:</span> <span style="color: #a6e22e">product</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">NA</span><span style="color: #f8f8f2">},</span>
          <span style="color: #a6e22e">Price</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">59.75</span><span style="color: #f8f8f2">,</span>
        <span style="color: #f8f8f2">},</span>
      <span style="color: #f8f8f2">}</span>

      <span style="color: #a6e22e">sort</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Sort</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">InventoryComparator</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">actual</span><span style="color: #f8f8f2">))</span>
      <span style="color: #a6e22e">So</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">actual</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">ShouldResemble</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">expected</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">})</span>
</pre></div>
</p>

<p>If you run the tests now you will see that our new test fails. This is correct and expected. The data now has <em>Product</em> items with the same name but differing sizes. Because of this they are not sorted correctly&hellip; Yet. Now we want to change the comparator code to make the test pass. Let&rsquo;s see how we can modify the <strong>Less()</strong> function to consider both name and size.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">func</span> <span style="color: #f8f8f2">(</span><span style="color: #a6e22e">items</span> <span style="color: #a6e22e">InventoryComparator</span><span style="color: #f8f8f2">)</span> <span style="color: #a6e22e">Less</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">i</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">j</span> <span style="color: #66d9ef">int</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">bool</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">if</span> <span style="color: #a6e22e">items</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">i</span><span style="color: #f8f8f2">].</span><span style="color: #a6e22e">Name</span> <span style="color: #f92672">!=</span> <span style="color: #a6e22e">items</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">j</span><span style="color: #f8f8f2">].</span><span style="color: #a6e22e">Name</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #66d9ef">return</span> <span style="color: #a6e22e">items</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">i</span><span style="color: #f8f8f2">].</span><span style="color: #a6e22e">Name</span> <span style="color: #f8f8f2">&lt;</span> <span style="color: #a6e22e">items</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">j</span><span style="color: #f8f8f2">].</span><span style="color: #a6e22e">Name</span>
  <span style="color: #f8f8f2">}</span> <span style="color: #66d9ef">else</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #66d9ef">return</span> <span style="color: #a6e22e">items</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">i</span><span style="color: #f8f8f2">].</span><span style="color: #a6e22e">Size</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">SortOrder</span> <span style="color: #f8f8f2">&lt;</span> <span style="color: #a6e22e">items</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">j</span><span style="color: #f8f8f2">].</span><span style="color: #a6e22e">Size</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">SortOrder</span>
  <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>The above code is simple. If the names of the products are different then return <strong>true</strong> if the first item is less than the second item (false otherwise). However if the names are the same, then we will return true/false if the size of the product is less than the size of the second product we are comparing to.</p>

<p><img src="/assets/adampresley/images/posts/golang-sort-passing-tests.png" alt="Passing tests" /></p>

<p>Go ahead and run the tests again. You should see a big <strong>PASS</strong> in a box at the top of the screen! Hopefully this is useful to you. Happy coding!</p>

            <ul class="share-buttons">
    <li></li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fadampresley.com%2fpost%2fsorting-inventory-items-in-go%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=Sorting%20Inventory%20Items%20in%20Go&amp;url=http%3a%2f%2fadampresley.com%2fpost%2fsorting-inventory-items-in-go%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-gplus" href="https://plus.google.com/share?url=http%3a%2f%2fadampresley.com%2fpost%2fsorting-inventory-items-in-go%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fadampresley.com%2fpost%2fsorting-inventory-items-in-go%2f&title=Sorting%20Inventory%20Items%20in%20Go" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title=""></a>
    </li>
</ul>

        </article>
        <div class="comments">
            <h3></h3>
            <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'adampresleyblog';
    var disqus_identifier = 'http:\/\/adampresley.com\/post\/sorting-inventory-items-in-go\/';
    var disqus_title = 'Sorting Inventory Items in Go';
    var disqus_url = 'http:\/\/adampresley.com\/post\/sorting-inventory-items-in-go\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    </main>
    <aside class="author">
  <img class="profile-image" src="http://adampresley.com/assets/adampresley/images/adam-bowtie.png" alt="Adam Presley" />
  <p class="name"> 
  <strong>Adam Presley</strong></p>
  <p class="address">Texas, USA</p>
  <p class="link"></p>
  <ul class="social">
    
<li><a href="//twitter.com/adampresley" class="icon-twitter" target="_blank" title="Twitter"></a></li>













<li><a href="//github.com/adampresley" class="icon-github" target="_blank" title="Github"></a></li>




<li><a href="http://adampresley.com/post/index.xml" class="icon-rss" target="_blank" title="RSS"></a></li>

  </ul>
  <br><br>
</aside>

</div>

<footer class="main-footer">
  <div class="container clearfix">
        <a class="icon-rss" href="http://adampresley.com/post/index.xml" title="RSS"></a>
        <p>&copy; 2016 &middot; Adam Presley. All Rights Reserved. Powered by <a href="http://gohugo.io">Hugo</a>.</p>
  </div>
</footer>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>window.jQuery || document.write('<script src="http:\/\/adampresley.com\/js/vendor/jquery-1.11.0.min.js"><\/script>')</script>
<script src="http://adampresley.com/js/plugins.js"></script>

<!-- Google Analytics -->
<script>
  var _gaq=[['_setAccount','UA-44927419-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>

