<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Adam.Blog()</title>
        <meta name="author">
        <meta name="description" content="I&#39;m bringin&#39; nerdy back">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="generator" content="Hugo 0.16-DEV" />
          <link href="http://adampresley.com/post/index.xml" rel="alternate" type="application/rss+xml" title="Adam.Blog()" />
          <link href="http://adampresley.com/post/index.xml" rel="feed" type="application/rss+xml" title="Adam.Blog()" />
        <link href='//fonts.googleapis.com/css?family=Roboto:400,300,700|Noto+Serif:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="http://adampresley.com/css/styles.css">
        <link rel="icon" href="http://adampresley.com/favicon.ico">
        <link rel="apple-touch-icon" href="http://adampresley.com/apple-touch-icon.png" />
        <link rel="stylesheet" href="http://adampresley.com/css/highlightjs/monokai.css">
        <script src="http://adampresley.com/js/vendor/modernizr-2.8.0.min.js"></script>
        <style>
        .site-header h2 .logo {
        background: url(http://adampresley.com/assets/images/code-background-screenshot.png) no-repeat 0 0;
        }
        @media (min--moz-device-pixel-ratio: 1.3), (-o-min-device-pixel-ratio: 2.6 / 2), (-webkit-min-device-pixel-ratio: 1.3), (min-device-pixel-ratio: 1.3), (min-resolution: 1.3dppx) {
          .site-header h2 .logo {
            background-image: url(http://adampresley.com/assets/images/code-background-screenshot.png);
        }}
       .site-header {
         background: #2a373d url(http://adampresley.com/assets/images/code-background-screenshot.png) no-repeat center center;
         z-index: -1;
        }
        </style>
    </head>
    <body>
        
        <header class="site-header">
          <div class="transparent-layer">
              <h2>Adam.Blog()</h2>
          </div>
        </header>


<div class="container clearfix">
    <main role="main" class="content">
        <article class="post">
            <a class="btn home" href="http://adampresley.com/" title="">&laquo; </a>
            
<h1><a href="http://adampresley.com/post/sublime-plugin-compare/" title="&#39;Sublime Plugin: Compare&#39;">&#39;Sublime Plugin: Compare&#39;</a></h1>

<footer class="post-info"> <span class="post-meta"><time datetime="2011.11.08">2011.11.08</time>

    &middot; 
        
        <a href="http://adampresley.com/tags/python">python</a>, 
        
        <a href="http://adampresley.com/tags/sublime">sublime</a>
        
    

</span>
</footer>

            <p>Not one to be completely happy with all existing features I found the
diff tool in Sublime Text 2 to be&hellip; lacking. The built in diff tool
allows you to select two files in the folder explorer, right click and
choose <em>Diff Files</em>. This action will produce a unified diff output.</p>

<p>I, however, would like to have a way to use a graphical diff tool,
because I&rsquo;m way too lazy to read the unified diff. So I decided to write
a plugin for Sublime. This plugin will allow me to map a key to run a
command that will compare the current tab&rsquo;s content with the contents of
the tab to the right. Let&rsquo;s walk through what that looks like. By the
way, plugins are written in Python.</p>

<p>First let&rsquo;s get the boilerplate stuff out of the way. We&rsquo;ll need to
import some stuff and create a class that extends a built in Sublime
class that will allow us to create a plugin.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">import</span> <span style="color: #f8f8f2">sublime</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">sublime_pluginimport</span> <span style="color: #f8f8f2">subprocessfrom</span> <span style="color: #f8f8f2">subprocess</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">Popen</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">string</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">Template</span>

<span style="color: #66d9ef">class</span> <span style="color: #a6e22e">CompareCommand</span><span style="color: #f8f8f2">(sublime_plugin</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">TextCommand):</span>
</pre></div>


<p>Now we need to define the <strong>run()</strong>method. The first argument is a
reference to <em>self</em>, followed by the edit environment, and an argument
called <em>command</em>, which will be an string containing the path to the
diff tool to run, and placeholders for the left and right file names.
More on that later when we map our new command to a key.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>	<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">run</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">edit,</span> <span style="color: #f8f8f2">command):</span>
</pre></div>


<p>The first task is to write two methods. The first will identify the
current buffer, or tab, we are working on when our plugin executes. The
second method will identify the buffer directly to the right. These
files will make up the left and right files to send to a diff tool.This
task is done by first getting the current view&rsquo;s ID, then looping over
all open views and finding the tab adjacent to our open one.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>	<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">__getCurrentBufferInfo</span><span style="color: #f8f8f2">(self):</span>
		<span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">{</span>
			<span style="color: #e6db74">&quot;id&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">view</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">buffer_id(),</span>
			<span style="color: #e6db74">&quot;fileName&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">view</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">file_name()</span>
		<span style="color: #f8f8f2">}</span>

	<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">__getNextBufferInfo</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">currentBuffer):</span>
		<span style="color: #f8f8f2">result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">None</span>
		<span style="color: #f8f8f2">found</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">False</span>

		<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">b</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">view</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">window()</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">views():</span>
			<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">found:</span>
				<span style="color: #f8f8f2">result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">{</span>
					<span style="color: #e6db74">&quot;id&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">b</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">buffer_id(),</span>
					<span style="color: #e6db74">&quot;fileName&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">b</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">file_name()</span>
				<span style="color: #f8f8f2">}</span>

				<span style="color: #66d9ef">break</span>

			<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">b</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">buffer_id()</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">currentBuffer[</span><span style="color: #e6db74">&quot;id&quot;</span><span style="color: #f8f8f2">]:</span>
				<span style="color: #f8f8f2">found</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">True</span>

		<span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">result</span>
</pre></div>


<p>Once we have the two file names we are going to compare let&rsquo;s open up
the specified diff tool and pass the files in. Our command in the key
mapping will define a string, and there will be two variables in there:
<strong>$leftFile</strong>and <strong>$rightFile</strong>. To fill in the variables we will use
the <strong>Template</strong>class. Once our string is filled in with file names we
will use the <strong>Subprocess</strong>class to execute. If there are any errors
they will be output to the Sublime console. Here is the entire listing.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">import</span> <span style="color: #f8f8f2">sublime</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">sublime_plugin</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">subprocess</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">subprocess</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">Popen</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">string</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">Template</span>

<span style="color: #66d9ef">class</span> <span style="color: #a6e22e">CompareCommand</span><span style="color: #f8f8f2">(sublime_plugin</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">TextCommand):</span>
	<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">run</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">edit,</span> <span style="color: #f8f8f2">command):</span>
		<span style="color: #f8f8f2">currentBuffer</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">__getCurrentBufferInfo()</span>
		<span style="color: #f8f8f2">nextBuffer</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">__getNextBufferInfo(currentBuffer)</span>

		<span style="color: #75715e">#</span>
		<span style="color: #75715e"># Compare the contents of the current buffer with the</span>
		<span style="color: #75715e"># contents of the next buffer (if there is one).</span>
		<span style="color: #75715e">#</span>
		<span style="color: #f8f8f2">processCommand</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[]</span>

		<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">nextBuffer</span> <span style="color: #f92672">!=</span> <span style="color: #f8f8f2">None:</span>
			<span style="color: #f8f8f2">processCommand</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Template(command)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">substitute(leftFile</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">currentBuffer[</span><span style="color: #e6db74">&quot;fileName&quot;</span><span style="color: #f8f8f2">],</span> <span style="color: #f8f8f2">rightFile</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">nextBuffer[</span><span style="color: #e6db74">&quot;fileName&quot;</span><span style="color: #f8f8f2">])</span>
			<span style="color: #66d9ef">print</span> <span style="color: #f8f8f2">processCommand</span>

			<span style="color: #75715e">#</span>
			<span style="color: #75715e"># Execute the command. Capture output on STDOUT, and write it out</span>
			<span style="color: #75715e"># to Sublime&#39;s console.</span>
			<span style="color: #75715e">#</span>
			<span style="color: #f8f8f2">p</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Popen(processCommand,</span> <span style="color: #f8f8f2">shell</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">True,</span> <span style="color: #f8f8f2">stdout</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">subprocess</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">PIPE,</span> <span style="color: #f8f8f2">stderr</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">subprocess</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">STDOUT)</span>
			<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">line</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">p</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">stdout</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">readlines():</span>
				<span style="color: #66d9ef">print</span> <span style="color: #f8f8f2">line</span>

			<span style="color: #f8f8f2">ret</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">p</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">wait()</span>
			<span style="color: #66d9ef">print</span> <span style="color: #e6db74">&quot;Return code: %s&quot;</span> <span style="color: #f92672">%</span> <span style="color: #f8f8f2">(ret)</span>

	<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">__getCurrentBufferInfo</span><span style="color: #f8f8f2">(self):</span>
		<span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">{</span>
			<span style="color: #e6db74">&quot;id&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">view</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">buffer_id(),</span>
			<span style="color: #e6db74">&quot;fileName&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">view</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">file_name()</span>
		<span style="color: #f8f8f2">}</span>

	<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">__getNextBufferInfo</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">currentBuffer):</span>
		<span style="color: #f8f8f2">result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">None</span>
		<span style="color: #f8f8f2">found</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">False</span>

		<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">b</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">view</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">window()</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">views():</span>
			<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">found:</span>
				<span style="color: #f8f8f2">result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">{</span>
					<span style="color: #e6db74">&quot;id&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">b</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">buffer_id(),</span>
					<span style="color: #e6db74">&quot;fileName&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">b</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">file_name()</span>
				<span style="color: #f8f8f2">}</span>

				<span style="color: #66d9ef">break</span>

			<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">b</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">buffer_id()</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">currentBuffer[</span><span style="color: #e6db74">&quot;id&quot;</span><span style="color: #f8f8f2">]:</span>
				<span style="color: #f8f8f2">found</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">True</span>

		<span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">result</span>
</pre></div>
</p>

<p>And now we can define a key mapping to be able to call our nifty plugin.
Here is an example of a key mapping using the Meld diff tool in Ubuntu.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">{</span> <span style="color: #e6db74">&quot;keys&quot;</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">[</span> <span style="color: #e6db74">&quot;ctrl+shift+c&quot;</span> <span style="color: #f8f8f2">],</span> <span style="color: #e6db74">&quot;command&quot;</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;compare&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;args&quot;</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">{</span> <span style="color: #e6db74">&quot;command&quot;</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;/usr/bin/meld &#39;$leftFile&#39; &#39;$rightFile&#39;&quot;</span> <span style="color: #f8f8f2">}</span> <span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>If you take the code above and save it in the Packages/User directory as
<strong>CompareCommand.py</strong>, and modify your user key mappings as shown above,
you should be able to hit CTRL+SHIFT+C and compare two files.</p>

<p>Not perfect, but was fun to write, and will prove useful for me until
the folks at Sublime put a full feature in and replace the need for this
plugin. Happy coding!</p>

            <ul class="share-buttons">
    <li></li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fadampresley.com%2fpost%2fsublime-plugin-compare%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=%27Sublime%20Plugin%3a%20Compare%27&amp;url=http%3a%2f%2fadampresley.com%2fpost%2fsublime-plugin-compare%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-gplus" href="https://plus.google.com/share?url=http%3a%2f%2fadampresley.com%2fpost%2fsublime-plugin-compare%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fadampresley.com%2fpost%2fsublime-plugin-compare%2f&title=%27Sublime%20Plugin%3a%20Compare%27" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title=""></a>
    </li>
</ul>

        </article>
        <div class="comments">
            <h3></h3>
            <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'adampresleyblog';
    var disqus_identifier = 'http:\/\/adampresley.com\/post\/sublime-plugin-compare\/';
    var disqus_title = '\x27Sublime Plugin: Compare\x27';
    var disqus_url = 'http:\/\/adampresley.com\/post\/sublime-plugin-compare\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    </main>
    <aside class="author">
  <img class="profile-image" src="http://adampresley.com/assets/adampresley/images/adam-bowtie.png" alt="Adam Presley" />
  <p class="name"> 
  <strong>Adam Presley</strong></p>
  <p class="address">Texas, USA</p>
  <p class="link"></p>
  <ul class="social">
    
<li><a href="//twitter.com/adampresley" class="icon-twitter" target="_blank" title="Twitter"></a></li>













<li><a href="//github.com/adampresley" class="icon-github" target="_blank" title="Github"></a></li>




<li><a href="http://adampresley.com/post/index.xml" class="icon-rss" target="_blank" title="RSS"></a></li>

  </ul>
  <br><br>
</aside>

</div>

<footer class="main-footer">
  <div class="container clearfix">
        <a class="icon-rss" href="http://adampresley.com/post/index.xml" title="RSS"></a>
        <p>&copy; 2016 &middot; Adam Presley. All Rights Reserved. Powered by <a href="http://gohugo.io">Hugo</a>.</p>
  </div>
</footer>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>window.jQuery || document.write('<script src="http:\/\/adampresley.com\/js/vendor/jquery-1.11.0.min.js"><\/script>')</script>
<script src="http://adampresley.com/js/plugins.js"></script>

<!-- Google Analytics -->
<script>
  var _gaq=[['_setAccount','UA-44927419-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>

