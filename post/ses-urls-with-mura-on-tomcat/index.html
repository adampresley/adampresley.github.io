<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Adam.Blog()</title>
        <meta name="author">
        <meta name="description" content="I&#39;m bringin&#39; nerdy back">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="generator" content="Hugo 0.16-DEV" />
          <link href="http://adampresley.com/post/index.xml" rel="alternate" type="application/rss+xml" title="Adam.Blog()" />
          <link href="http://adampresley.com/post/index.xml" rel="feed" type="application/rss+xml" title="Adam.Blog()" />
        <link href='//fonts.googleapis.com/css?family=Roboto:400,300,700|Noto+Serif:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="http://adampresley.com/css/styles.css">
        <link rel="icon" href="http://adampresley.com/favicon.ico">
        <link rel="apple-touch-icon" href="http://adampresley.com/apple-touch-icon.png" />
        <link rel="stylesheet" href="http://adampresley.com/css/highlightjs/monokai.css">
        <script src="http://adampresley.com/js/vendor/modernizr-2.8.0.min.js"></script>
        <style>
        .site-header h2 .logo {
        background: url(http://adampresley.com/assets/images/code-background-screenshot.png) no-repeat 0 0;
        }
        @media (min--moz-device-pixel-ratio: 1.3), (-o-min-device-pixel-ratio: 2.6 / 2), (-webkit-min-device-pixel-ratio: 1.3), (min-device-pixel-ratio: 1.3), (min-resolution: 1.3dppx) {
          .site-header h2 .logo {
            background-image: url(http://adampresley.com/assets/images/code-background-screenshot.png);
        }}
       .site-header {
         background: #2a373d url(http://adampresley.com/assets/images/code-background-screenshot.png) no-repeat center center;
         z-index: -1;
        }
        </style>
    </head>
    <body>
        
        <header class="site-header">
          <div class="transparent-layer">
              <h2>Adam.Blog()</h2>
          </div>
        </header>


<div class="container clearfix">
    <main role="main" class="content">
        <article class="post">
            <a class="btn home" href="http://adampresley.com/" title="">&laquo; </a>
            
<h1><a href="http://adampresley.com/post/ses-urls-with-mura-on-tomcat/" title="SES URLs With Mura on Tomcat">SES URLs With Mura on Tomcat</a></h1>

<footer class="post-info"> <span class="post-meta"><time datetime="2010.07.02">2010.07.02</time>

    &middot; 
        
        <a href="http://adampresley.com/tags/development">development</a>, 
        
        <a href="http://adampresley.com/tags/coldfusion">coldfusion</a>, 
        
        <a href="http://adampresley.com/tags/mura">mura</a>
        
    

</span>
</footer>

            <p>Tonight as I&rsquo;m setting up a new server I wanted to make sure I had URL
rewrite ability. Normally this is no issue as I use Apache for most
anything web server related. However this time I am setting up a Mura
site on Railo running on Tomcat. And yes, I&rsquo;m using Tomcat for both my
Java Servlet engine and my web server. As such I wanted to ensure I have
&ldquo;pretty URLs&rdquo; for my Mura-based application. In this post I will attempt
to show you how to set that up.</p>

<p>At this point I am going to assume you have a running Tomcat and Mura
application. The first thing we need to do is download Paul Tuckey&rsquo;s
excellent UrlRewriteFilter Java filter. This can be located at
<a href="http://www.tuckey.org/urlrewrite/">http://www.tuckey.org/urlrewrite/</a>. The version I downloaded as of this
writing is 3.2.0. Once downloaded you can extract the contents anywhere
you wish to keep it. You will notice there isn&rsquo;t much there&hellip; in fact
at the top level there is only a folder named <strong>WEB-INF</strong>. Opening that
folder doesn&rsquo;t reveal much more.</p>

<p>If you have Tomcat running you&rsquo;ll need to stop it temporarily for this
next part. After stopping Tomcat, copy the file
<strong>/WEB-INF/lib/urlrewrite-3.2.0.jar</strong> into your lib folder, found at
<strong>{TOMCAT}/lib</strong>, where <strong>{TOMCAT}</strong> is the folder where you have placed
your Tomcat installation. By copying this JAR file there you are making
the URL re-writer filter available to all Java applications running in
your Tomcat instance.</p>

<p>The next phase is to setup Railo (yes, you can do this in Adobe CF as
well) to use this Java re-writer filter. Where you do this varies based
on how you have setup your Railo application, but I have my Railo files
extracted in my Mura application&rsquo;s web root directory. So in my main
Mura directory I have a <strong>WEB-INF</strong> folder containing the entire Railo
<strong>library</strong>.</p>

<p>If you open up that <strong>WEB-INF</strong> folder there should be a <strong>web.xml</strong>
file. Open this file in your favorite text editor. Near the top, after
the <strong><display-name></strong> node and before the <strong><servlet></strong> nodes paste
the following XML.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">&lt;!-- URL Rewrite Filter --&gt;</span>
<span style="color: #f92672">&lt;filter&gt;</span>
	<span style="color: #f92672">&lt;filter-name&gt;</span>UrlRewriteFilter<span style="color: #f92672">&lt;/filter-name&gt;</span>
	<span style="color: #f92672">&lt;filter-class&gt;</span>org.tuckey.web.filters.urlrewrite.UrlRewriteFilter<span style="color: #f92672">&lt;/filter-class&gt;</span>
	<span style="color: #f92672">&lt;init-param&gt;</span>
		<span style="color: #f92672">&lt;param-name&gt;</span>logLevel<span style="color: #f92672">&lt;/param-name&gt;</span>
		<span style="color: #f92672">&lt;param-value&gt;</span>WARN<span style="color: #f92672">&lt;/param-value&gt;</span>
	<span style="color: #f92672">&lt;/init-param&gt;</span>
<span style="color: #f92672">&lt;/filter&gt;</span>
<span style="color: #f92672">&lt;filter-mapping&gt;</span>
	<span style="color: #f92672">&lt;filter-name&gt;</span>UrlRewriteFilter<span style="color: #f92672">&lt;/filter-name&gt;</span>
	<span style="color: #f92672">&lt;servlet-name&gt;</span>CFMLServlet<span style="color: #f92672">&lt;/servlet-name&gt;</span>
<span style="color: #f92672">&lt;/filter-mapping&gt;</span>
</pre></div>


<p>This block of XML tells Tomcat, when loading your application, to
install this URL re-write filter, and to map any requests that come
through the <strong>CFMLServlet</strong> to it. Basically that means that any CFM or
CFC requests will go through the filter.</p>

<p>The next part of this same file that must be altered is the servlet
mappings to allow paths after &ldquo;index.cfm&rdquo;. This allows Mura to execute
requests like &ldquo;/index.cfm/contact-us/&rdquo;. To do this find the following
block of XML:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">&lt;servlet-mapping&gt;</span>
	<span style="color: #f92672">&lt;servlet-name&gt;</span>CFMLServlet<span style="color: #f92672">&lt;/servlet-name&gt;</span>
	<span style="color: #f92672">&lt;url-pattern&gt;</span>*.cfm<span style="color: #f92672">&lt;/url-pattern&gt;</span>
<span style="color: #f92672">&lt;/servlet-mapping&gt;</span>
</pre></div>


<p>Once you find this, you want to insert this next block of XML <strong>right
after it</strong>.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">&lt;servlet-mapping&gt;</span>
	<span style="color: #f92672">&lt;servlet-name&gt;</span>CFMLServlet<span style="color: #f92672">&lt;/servlet-name&gt;</span>
	<span style="color: #f92672">&lt;url-pattern&gt;</span>/index.cfm/*<span style="color: #f92672">&lt;/url-pattern&gt;</span>
<span style="color: #f92672">&lt;/servlet-mapping&gt;</span>
</pre></div>


<p>Now we are ready to configure the re-writer filter to forward our
&ldquo;pretty&rdquo; SES URLs to index.cfm! In the extracted files there is a file
named <strong>urlrewrite.xml</strong>. Copy this file into the same folder as your
Railo <strong>web.xml</strong> file that we just got done modifying. Now open it up.
Fortunately this file is pretty well documented, and the online docs
have even more information! For the moment, though, we just want to make
sure that all of our SES URLs go to the right place. The other concern
here is to also ensure that when we go to Mura&rsquo;s administrator, the URLs
<strong>DO NOT</strong> get forwarded to <strong>index.cfm</strong>. So, with a little bit of
regular expression magic, we can make UrlRewriteFilter do this.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span style="color: #75715e">&lt;!DOCTYPE urlrewrite PUBLIC &quot;-//tuckey.org//DTD UrlRewrite 3.2//EN&quot; &quot;http://tuckey.org/res/dtds/urlrewrite3.2.dtd&quot;&gt;</span>

<span style="color: #75715e">&lt;!--</span>
<span style="color: #75715e">	Configuration file for UrlRewriteFilter</span>
<span style="color: #75715e">	http://tuckey.org/urlrewrite/</span>
<span style="color: #75715e">--&gt;</span>
<span style="color: #f92672">&lt;urlrewrite&gt;</span>
	<span style="color: #f92672">&lt;rule&gt;</span>
		<span style="color: #f92672">&lt;note&gt;</span>Makes all requests forward to /index.cfm/whatever-came-next
		Ignores admin URLs so the admin still works correctly for Mura.<span style="color: #f92672">&lt;/note&gt;</span>
		<span style="color: #f92672">&lt;from&gt;</span>^/(?!admin|plugins|js|css|assets|images|tasks|railo-context|flex2gateway|wysiwyg)(.*)$<span style="color: #f92672">&lt;/from&gt;</span>
		<span style="color: #f92672">&lt;to&gt;</span>/index.cfm/$1<span style="color: #f92672">&lt;/to&gt;</span>
	<span style="color: #f92672">&lt;/rule&gt;</span>
<span style="color: #f92672">&lt;/urlrewrite&gt;</span>
</pre></div>
</p>

<p>Ok, super. The final phase is to tell Mura that we wish to make our
URL&rsquo;s pretty! To do this, start Tomcat back up, then log into your Mura
administrator and browse to <strong>File Manager -&gt; Application Root</strong> and
click on the folder <strong>config</strong>. In this folder there is a file named
<strong>settings.ini.cfm</strong>. Click on the <strong>pencil</strong> icon to the right of the
file name to edit it. Once inside we are looking for two settings:
<strong>siteidinurls</strong> and <strong>indexfileinurls</strong>. These settings should both be
set to zero (0). Once you save those changes make sure to click on
<strong>Reload Application</strong>.</p>

<p>And with that you should be able to browse to your Mura site <strong>without</strong>
the crazy question marks or <strong>index.cfm</strong> in the URL. But if you are in
the administrator you should still have all the question marks so it
behaves as expected.</p>

<p>I hope this helped somebody out there. Cheers, and happy coding!</p>

            <ul class="share-buttons">
    <li></li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fadampresley.com%2fpost%2fses-urls-with-mura-on-tomcat%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=SES%20URLs%20With%20Mura%20on%20Tomcat&amp;url=http%3a%2f%2fadampresley.com%2fpost%2fses-urls-with-mura-on-tomcat%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-gplus" href="https://plus.google.com/share?url=http%3a%2f%2fadampresley.com%2fpost%2fses-urls-with-mura-on-tomcat%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fadampresley.com%2fpost%2fses-urls-with-mura-on-tomcat%2f&title=SES%20URLs%20With%20Mura%20on%20Tomcat" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title=""></a>
    </li>
</ul>

        </article>
        <div class="comments">
            <h3></h3>
            <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'adampresleyblog';
    var disqus_identifier = 'http:\/\/adampresley.com\/post\/ses-urls-with-mura-on-tomcat\/';
    var disqus_title = 'SES URLs With Mura on Tomcat';
    var disqus_url = 'http:\/\/adampresley.com\/post\/ses-urls-with-mura-on-tomcat\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    </main>
    <aside class="author">
  <img class="profile-image" src="http://adampresley.com/assets/adampresley/images/adam-bowtie.png" alt="Adam Presley" />
  <p class="name"> 
  <strong>Adam Presley</strong></p>
  <p class="address">Texas, USA</p>
  <p class="link"></p>
  <ul class="social">
    
<li><a href="//twitter.com/adampresley" class="icon-twitter" target="_blank" title="Twitter"></a></li>













<li><a href="//github.com/adampresley" class="icon-github" target="_blank" title="Github"></a></li>




<li><a href="http://adampresley.com/post/index.xml" class="icon-rss" target="_blank" title="RSS"></a></li>

  </ul>
  <br><br>
</aside>

</div>

<footer class="main-footer">
  <div class="container clearfix">
        <a class="icon-rss" href="http://adampresley.com/post/index.xml" title="RSS"></a>
        <p>&copy; 2016 &middot; Adam Presley. All Rights Reserved. Powered by <a href="http://gohugo.io">Hugo</a>.</p>
  </div>
</footer>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>window.jQuery || document.write('<script src="http:\/\/adampresley.com\/js/vendor/jquery-1.11.0.min.js"><\/script>')</script>
<script src="http://adampresley.com/js/plugins.js"></script>

<!-- Google Analytics -->
<script>
  var _gaq=[['_setAccount','UA-44927419-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>

