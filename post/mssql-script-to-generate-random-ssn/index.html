<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Adam.Blog()</title>
        <meta name="author">
        <meta name="description" content="I&#39;m bringin&#39; nerdy back">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="generator" content="Hugo 0.16-DEV" />
          <link href="http://adampresley.com/post/index.xml" rel="alternate" type="application/rss+xml" title="Adam.Blog()" />
          <link href="http://adampresley.com/post/index.xml" rel="feed" type="application/rss+xml" title="Adam.Blog()" />
        <link href='//fonts.googleapis.com/css?family=Roboto:400,300,700|Noto+Serif:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="http://adampresley.com/css/styles.css">
        <link rel="icon" href="http://adampresley.com/favicon.ico">
        <link rel="apple-touch-icon" href="http://adampresley.com/apple-touch-icon.png" />
        <link rel="stylesheet" href="http://adampresley.com/css/highlightjs/monokai.css">
        <script src="http://adampresley.com/js/vendor/modernizr-2.8.0.min.js"></script>
        <style>
        .site-header h2 .logo {
        background: url(http://adampresley.com/assets/images/code-background-screenshot.png) no-repeat 0 0;
        }
        @media (min--moz-device-pixel-ratio: 1.3), (-o-min-device-pixel-ratio: 2.6 / 2), (-webkit-min-device-pixel-ratio: 1.3), (min-device-pixel-ratio: 1.3), (min-resolution: 1.3dppx) {
          .site-header h2 .logo {
            background-image: url(http://adampresley.com/assets/images/code-background-screenshot.png);
        }}
       .site-header {
         background: #2a373d url(http://adampresley.com/assets/images/code-background-screenshot.png) no-repeat center center;
         z-index: -1;
        }
        </style>
    </head>
    <body>
        
        <header class="site-header">
          <div class="transparent-layer">
              <h2>Adam.Blog()</h2>
          </div>
        </header>


<div class="container clearfix">
    <main role="main" class="content">
        <article class="post">
            <a class="btn home" href="http://adampresley.com/" title="">&laquo; </a>
            
<h1><a href="http://adampresley.com/post/mssql-script-to-generate-random-ssn/" title="MSSQL Script to Generate Random SSN">MSSQL Script to Generate Random SSN</a></h1>

<footer class="post-info"> <span class="post-meta"><time datetime="2010.09.26">2010.09.26</time>

    &middot; 
        
        <a href="http://adampresley.com/tags/development">development</a>, 
        
        <a href="http://adampresley.com/tags/sql">sql</a>
        
    

</span>
</footer>

            <p>If you&rsquo;ve ever worked with a database that contains sensitive data you
may have had the task of &ldquo;scrubbing&rdquo;, or cleaning the data so it can be
used by the average developer and QA engineer. Last week I was working
on setting up a testing server and received a &ldquo;scrubbed&rdquo; database from
our database team. They had taken and cleaned up all the sensitive data.
For the social security numbers they had changed each one to
&ldquo;111-11-1111&rdquo;. This is normally fine, but we ran into a ColdFusion page
that was querying for all duplicate SSNs, and displaying links on the
page to alert a user to go and correct the duplicate entry. This would
normally been innocent enough except that there were over 600,000
entries in the system, and caused Internet Explorer to live up to its
nickname, Internet Exploder.</p>

<p>To correct this I crafted a simple SQL script to randomize the SSNs,
making the data feel a bit more natural, and the page not crash. Here it
is.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">DECLARE</span> <span style="color: #f92672">@</span><span style="color: #f8f8f2">id</span> <span style="color: #f8f8f2">INT</span>
<span style="color: #66d9ef">DECLARE</span> <span style="color: #f92672">@</span><span style="color: #f8f8f2">newSSN</span> <span style="color: #f8f8f2">VARCHAR(</span><span style="color: #ae81ff">11</span><span style="color: #f8f8f2">)</span>

<span style="color: #66d9ef">DECLARE</span> <span style="color: #f8f8f2">pcursor</span> <span style="color: #66d9ef">CURSOR</span> <span style="color: #66d9ef">FOR</span> <span style="color: #66d9ef">SELECT</span>
    <span style="color: #f8f8f2">id</span>
<span style="color: #66d9ef">FROM</span> <span style="color: #f8f8f2">personTable</span> <span style="color: #66d9ef">WHERE</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">=</span><span style="color: #ae81ff">1</span>

<span style="color: #66d9ef">OPEN</span> <span style="color: #f8f8f2">pcursor</span>
<span style="color: #66d9ef">FETCH</span> <span style="color: #66d9ef">NEXT</span> <span style="color: #66d9ef">FROM</span> <span style="color: #f8f8f2">pcursor</span> <span style="color: #66d9ef">INTO</span> <span style="color: #f92672">@</span><span style="color: #f8f8f2">id</span>

<span style="color: #f8f8f2">WHILE</span> <span style="color: #f92672">@@</span><span style="color: #f8f8f2">FETCH_STATUS</span><span style="color: #f92672">=</span><span style="color: #ae81ff">0</span>
<span style="color: #66d9ef">BEGIN</span>
    <span style="color: #66d9ef">SET</span> <span style="color: #f92672">@</span><span style="color: #f8f8f2">newSSN</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">(</span><span style="color: #66d9ef">CAST</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">CAST</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">100</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">(</span><span style="color: #ae81ff">898</span> <span style="color: #f92672">*</span> <span style="color: #f8f8f2">RAND())</span> <span style="color: #66d9ef">AS</span> <span style="color: #f8f8f2">INT)</span> <span style="color: #66d9ef">AS</span> <span style="color: #f8f8f2">VARCHAR(</span><span style="color: #ae81ff">3</span><span style="color: #f8f8f2">))</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&#39;-&#39;</span> <span style="color: #f92672">+</span> <span style="color: #66d9ef">CAST</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">CAST</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">10</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">(</span><span style="color: #ae81ff">88</span> <span style="color: #f92672">*</span> <span style="color: #f8f8f2">RAND())</span> <span style="color: #66d9ef">AS</span> <span style="color: #f8f8f2">INT)</span> <span style="color: #66d9ef">AS</span> <span style="color: #f8f8f2">VARCHAR(</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">))</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&#39;-&#39;</span> <span style="color: #f92672">+</span> <span style="color: #66d9ef">CAST</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">CAST</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">1000</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">(</span><span style="color: #ae81ff">8998</span> <span style="color: #f92672">*</span> <span style="color: #f8f8f2">RAND())</span> <span style="color: #66d9ef">AS</span> <span style="color: #f8f8f2">INT)</span> <span style="color: #66d9ef">AS</span> <span style="color: #f8f8f2">VARCHAR(</span><span style="color: #ae81ff">4</span><span style="color: #f8f8f2">)))</span>
    <span style="color: #f8f8f2">PRINT</span> <span style="color: #f92672">@</span><span style="color: #f8f8f2">newSSN</span>

    <span style="color: #66d9ef">UPDATE</span> <span style="color: #f8f8f2">personTable</span> <span style="color: #66d9ef">SET</span>
        <span style="color: #f8f8f2">SSN</span><span style="color: #f92672">=@</span><span style="color: #f8f8f2">newSSN</span>
    <span style="color: #66d9ef">WHERE</span>
        <span style="color: #f8f8f2">id</span><span style="color: #f92672">=@</span><span style="color: #f8f8f2">id</span>

    <span style="color: #66d9ef">FETCH</span> <span style="color: #66d9ef">NEXT</span> <span style="color: #66d9ef">FROM</span> <span style="color: #f8f8f2">pcursor</span> <span style="color: #66d9ef">INTO</span> <span style="color: #f92672">@</span><span style="color: #f8f8f2">id</span>
<span style="color: #66d9ef">END</span>

<span style="color: #66d9ef">CLOSE</span> <span style="color: #f8f8f2">pcursor</span>
<span style="color: #66d9ef">DEALLOCATE</span> <span style="color: #f8f8f2">pcursor</span>
</pre></div>


<p>This little script simple gets a cursor for all the people in our table
and iterates over them. For each iteration we create a random SSN value
using the RAND() function and casting them to VARCHARs. We update the
value in the table, grab the next record from the cursor, and
rinse/lather/repeat until we are done.</p>

<p>Happy coding!</p>

            <ul class="share-buttons">
    <li></li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fadampresley.com%2fpost%2fmssql-script-to-generate-random-ssn%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=MSSQL%20Script%20to%20Generate%20Random%20SSN&amp;url=http%3a%2f%2fadampresley.com%2fpost%2fmssql-script-to-generate-random-ssn%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-gplus" href="https://plus.google.com/share?url=http%3a%2f%2fadampresley.com%2fpost%2fmssql-script-to-generate-random-ssn%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fadampresley.com%2fpost%2fmssql-script-to-generate-random-ssn%2f&title=MSSQL%20Script%20to%20Generate%20Random%20SSN" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title=""></a>
    </li>
</ul>

        </article>
        <div class="comments">
            <h3></h3>
            <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'adampresleyblog';
    var disqus_identifier = 'http:\/\/adampresley.com\/post\/mssql-script-to-generate-random-ssn\/';
    var disqus_title = 'MSSQL Script to Generate Random SSN';
    var disqus_url = 'http:\/\/adampresley.com\/post\/mssql-script-to-generate-random-ssn\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    </main>
    <aside class="author">
  <img class="profile-image" src="http://adampresley.com/assets/adampresley/images/adam-bowtie.png" alt="Adam Presley" />
  <p class="name"> 
  <strong>Adam Presley</strong></p>
  <p class="address">Texas, USA</p>
  <p class="link"></p>
  <ul class="social">
    
<li><a href="//twitter.com/adampresley" class="icon-twitter" target="_blank" title="Twitter"></a></li>













<li><a href="//github.com/adampresley" class="icon-github" target="_blank" title="Github"></a></li>




<li><a href="http://adampresley.com/post/index.xml" class="icon-rss" target="_blank" title="RSS"></a></li>

  </ul>
  <br><br>
</aside>

</div>

<footer class="main-footer">
  <div class="container clearfix">
        <a class="icon-rss" href="http://adampresley.com/post/index.xml" title="RSS"></a>
        <p>&copy; 2016 &middot; Adam Presley. All Rights Reserved. Powered by <a href="http://gohugo.io">Hugo</a>.</p>
  </div>
</footer>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>window.jQuery || document.write('<script src="http:\/\/adampresley.com\/js/vendor/jquery-1.11.0.min.js"><\/script>')</script>
<script src="http://adampresley.com/js/plugins.js"></script>

<!-- Google Analytics -->
<script>
  var _gaq=[['_setAccount','UA-44927419-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>

